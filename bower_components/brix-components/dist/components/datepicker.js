!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("jquery"),require("underscore"),require("moment"),require("components/base"),require("brix/event")):"function"==typeof define&&define.amd?define(["jquery","underscore","moment","components/base","brix/event"],e):"object"==typeof exports?exports["components/datepicker"]=e(require("jquery"),require("underscore"),require("moment"),require("components/base"),require("brix/event")):t["components/datepicker"]=e(t.jquery,t.underscore,t.moment,t["components/base"],t["brix/event"])}(this,function(t,e,n,i,a){return function(t){function e(i){if(n[i])return n[i].exports;var a=n[i]={exports:{},id:i,loaded:!1};return t[i].call(a.exports,a,a.exports,e),a.loaded=!0,a.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){t.exports=n(1)},function(t,e,n){var i,a;i=[n(2),n(3),n(4),n(5),n(6),n(7)],a=function(t,e,n,i,a,s){function r(){}var o=".datepicker",c="second minute hour time date month year",d="YYYY-MM-DD",p="HH:mm:ss",l=d+" "+p;return r.NAMESPACE=o,r.TYPES=c,r.DATE_PATTERN=d,r.TIME_PATTERN=p,r.DATE_TIME_PATTERN=l,r.typeMap=function(t){e.indexOf(["all","",void 0],t)!==-1&&(t=c);var n={};return e.each(t.split(/\s+/),function(t){n[t]=!0}),n.time=n.time||n.hour||n.minute||n.second,n},e.extend(r.prototype,i.prototype,{options:{date:n(),type:"all",range:[],excluded:[],unlimit:!1},init:function(){this.options.range=e.flatten(this.options.range),this.options.excluded=e.flatten(this.options.excluded),this.options.unlimit&&(this.options.unlimit=n(this.options.unlimit,e.isString(this.options.unlimit)&&l)),this.data=this.data||{},this.data.options=this.options,this.data.moment=n,this.data.date=n(this.options.date,e.isString(this.options.date)&&l),this.options.unlimit&&this.options.unlimit.toDate().getTime()===this.data.date.toDate().getTime()&&(this.__unlimit=this.options.unlimit),this.data.typeMap=r.typeMap(this.options.type)},render:function(){this.$element=t(this.element).append(e.template(s)(this.data));var n=this.$manager=new a("bx-");n.delegate(this.$element,this),this._renderYearPicker()._renderMonthPicker()._renderDatePicker()._renderTimePicker()},val:function(i){var a=this.data.date.toDate().getTime();if(i){this.__unlimit=!1,this.data.date=n(i,e.isString(i)&&l);var s=this.data.date.toDate().getTime()===a,r=t.Event((s?"unchange":"change")+o);return this.trigger(r,n(this.data.date)),s||this._renderYearPicker()._renderMonthPicker()._renderDatePicker()._renderTimePicker(),this}return n(this.__unlimit||this.data.date)},range:function(t){return t?(this.options.range=e.flatten(t),this._renderDatePicker(),this):this.options.range},excluded:function(t){return t?(this.options.excluded=e.flatten(t),this._renderDatePicker(),this):this.options.excluded},_slide:function(t,e,n){2==arguments.length&&(n=e,e=t),this.$element.find(e).slideUp("fast"),this.$element.find(n).slideDown("fast")},_move:function(e,i,a){var s=this.__isUnlimitMode();s&&(this.data.date=n().startOf("day")),this.__unlimit=!1;var r=this.data.date,c=r.toDate().getTime();if("period"===i)return void this._renderYearPicker(a)._renderDatePicker();r.add(a,i);var d=r.toDate().getTime()===c,p=t.Event((d?"unchange":"change")+o);this.trigger(p,[n(r),i]),d||this._renderYearPicker()._renderMonthPicker()._renderDatePicker()},_active:function(e,i){var a=this.__isUnlimitMode();a&&(this.data.date=n().startOf("day")),this.__unlimit=!1;var s=this.data.date,r=s.toDate().getTime(),c=t(e.target);s.set(i,+c.attr("data-value"));var d=s.toDate().getTime()===r,p=t.Event((d?"unchange":"change")+o);switch(this.trigger(p,[n(s),i]),d||this._renderYearPicker()._renderMonthPicker()._renderDatePicker(),i){case"year":if(this.data.typeMap.year)break;this._slide(".yearpicker",".monthpicker");break;case"month":if(this.data.typeMap.month)break;this._slide(".monthpicker",".datepicker")}},_hooks:{38:1,40:-1},_changeTime:function(e,i,a,s){this.__unlimit=!1;var r=this.data.date;if(void 0===i&&void 0===a&&void 0===s){var c=t.Event("change"+o);return void this.trigger(c,[n(r),"time"])}var d=r.toDate().getTime();if("keydown"===e.type){if(!this._hooks[e.which])return;i=this._hooks[e.which]||0}"blur"!==e.type&&"focusout"!==e.type||(this.data.date.set(a,e.target.value),i=0),r.add(i,s),e.preventDefault(),e.stopPropagation();var p=r.toDate().getTime()===d,l=t.Event((p?"unchange":"change")+o);this.trigger(l,[n(r),a]),p||this._renderTimePicker()._renderYearPicker()._renderMonthPicker()._renderDatePicker()},_changeHour:function(t,e){this._changeTime(t,e,"hour","hours")},_changeMinute:function(t,e){this._changeTime(t,e,"minute","minutes")},_changeSecond:function(t,e){this._changeTime(t,e,"second","seconds")},__isUnlimitMode:function(){return this.options.unlimit&&(this.__unlimit||this.options.unlimit.toDate().getTime()===this.data.date.toDate().getTime())&&!0||!1},_renderYearPicker:function(e){e=e||0;var i=this.data.date,a=this.__isUnlimitMode();a&&(i=n().startOf("day"));var s=this.$element.find(".yearpicker .picker-header h4"),r=this.$element.find(".yearpicker .picker-body"),o=20,c=r.data(),d=i.get("year");c.start=(c.start||d-d%o)+e*o,c.end=c.start+o-1,s.text(c.start+" - "+c.end),r.empty();for(var p=c.start;p<=c.end;p++)t("<span>").text(p).attr("data-value",p).attr("bx-click",'_active("year")').addClass(a||d!==p?"":"active").appendTo(r);return this},_renderMonthPicker:function(){var i=this.data.date,a=this.__isUnlimitMode();a&&(i=n().startOf("day"));var s=this.$element.find(".monthpicker .picker-header h4"),r=this.$element.find(".monthpicker .picker-body");s.text(i.get("year")),r.empty();var o=function(){for(var t=[],e=1;e<=12;e++)t.push(e<10?"0"+e:e);return t}();return e.each(o,function(e,n){t("<span>").text(e).attr("data-value",n).addClass(a||i.get("month")!==n?"":"active").attr("bx-click",'_active("month")').appendTo(r)}),this},_renderDatePicker:function(){function i(t){if(!d.length)return!0;for(var i,a,r=n(s).startOf("day").set("date",t),o=0;o<d.length;o+=2){if(i=d[o]&&n(d[o],e.isString(d[o])&&l).startOf("day"),a=d[o+1]&&n(d[o+1],e.isString(d[o+1])&&l).startOf("day"),i&&a){var c=n.min(i,a),p=n.max(i,a);i=c,a=p}if(i&&a&&r.diff(i,"days")>=0&&r.diff(a,"days")<=0)return!0;if(i&&!a&&r.diff(i,"days")>=0)return!0;if(!i&&a&&r.diff(a,"days")<=0)return!0;if(!i&&!a)return!0}return!1}function a(t){if(!p.length)return!1;for(var i,a,r=n(s).startOf("day").set("date",t),o=0;o<p.length;o+=2){if(i=p[o]&&n(p[o],e.isString(p[o])&&l).startOf("day"),a=p[o+1]&&n(p[o+1],e.isString(p[o+1])&&l).startOf("day"),i&&a){var c=n.min(i,a),d=n.max(i,a);i=c,a=d}if(i&&a&&r.diff(i,"days")>=0&&r.diff(a,"days")<=0)return!0;if(i&&!a&&r.diff(i,"days")>=0)return!0;if(!i&&a&&r.diff(a,"days")<=0)return!0;if(!i&&!a)return!0}return!1}var s=this.data.date,r=this.__isUnlimitMode();r&&(s=n().startOf("day"));var o=s.daysInMonth(),c=n(s).date(1).day(),d=this.options.range,p=this.options.excluded,u=this.$element.find(".datepicker .picker-header h4"),h=this.$element.find(".datepicker .picker-body .datepicker-body-value");u.text(s.format("YYYY - MM")),h.empty();for(var m=0;m<c;m++)t('<span class="inactive">').appendTo(h);for(var f=1;f<=o;f++)t("<span>").text(f).attr("data-value",f).addClass(r||s.date()!==f?"":"active").addClass(!i(f)||a(f)?"disabled":"").attr("bx-click",'_active("date")').appendTo(h);return this},_renderTimePicker:function(){var t=n(this.data.date),e=this.$element.find(".timepicker div.timepicker-group input");return e.eq(0).val(t.format("HH")),e.eq(1).val(t.format("mm")),e.eq(2).val(t.format("ss")),this},_unlimit:function(){var e=this.options.unlimit;this.__unlimit=e;var n=e.isSame(this.data.date),i=t.Event((n?"unchange":"change")+o);this.trigger(i,[e,"date"]),this._renderYearPicker()._renderMonthPicker()._renderDatePicker()},destroy:function(){this.$manager.undelegate(this.$element,this)}}),r}.apply(e,i),!(void 0!==a&&(t.exports=a))},function(e,n){e.exports=t},function(t,n){t.exports=e},function(t,e){t.exports=n},function(t,e){t.exports=i},function(t,e){t.exports=a},function(t,e,n){var i;i=function(){return'<div class="datepicker-container">\n    <!-- 年 -->\n    <% var yearDisplay = typeMap.year && !typeMap.month && !typeMap.date ? \'\' : \'display: none;\' %>\n    <div class="yearpicker picker-group" style="<%= yearDisplay %>">\n        <div class="picker-header">\n            <a href="javascript:;" class="minus" bx-click="_move(\'period\', -1)"><span class="brixfont">&#xe601;</span></a>\n            <!-- <button class="btn btn-default minus" type="button" bx-click="_move(\'period\', -1)"><span class="glyphicon glyphicon-chevron-left"></span></button> -->\n            <h4 >? - ?</h4>\n            <a href="javascript:;" class="plus" type="button" bx-click="_move(\'period\', 1)"><span class="brixfont">&#xe600;</span></a>\n            <!-- <button class="btn btn-default plus" type="button" bx-click="_move(\'period\', 1)"><span class="glyphicon glyphicon-chevron-right"></span></button> -->\n        </div>\n        <div class="picker-body picker-selectable clearfix">\n            <!-- <span data-value="2014" class="active">2014</span> -->\n            <!-- <span data-value="2014">2014</span> -->\n        </div>\n    </div>\n    <!-- 月 -->\n    <% var monthDisplay = typeMap.month && !typeMap.date ? \'\' : \'display: none;\' %>\n    <div class="monthpicker picker-group" style="<%= monthDisplay %>">\n        <div class="picker-header">\n            <a href="javascript:;" class="minus" type="button" bx-click="_move(\'year\', -1)"><span class="brixfont">&#xe601;</span></a>\n            <!-- <button class="btn btn-default minus" type="button" bx-click="_move(\'year\', -1)"><span class="glyphicon glyphicon-chevron-left"></span></button> -->\n            <h4 bx-click="_slide(\'.monthpicker\', \'.yearpicker\')">?</h4>\n            <a href="javascript:;" class="plus" type="button" bx-click="_move(\'year\', 1)"><span class="brixfont">&#xe600;</span></a>\n            <!-- <button class="btn btn-default plus" type="button" bx-click="_move(\'year\', 1)"><span class="glyphicon glyphicon-chevron-right"></span></button> -->\n        </div>\n        <div class="picker-body picker-selectable clearfix">\n            <!-- <span data-value="1" class="active">Jan</span -->\n            <!-- <span data-value="1">Jan</span -->\n        </div>\n    </div>\n    <!-- 日 -->\n    <% var dateDisplay = typeMap.date ? \'\' : \'display: none;\' %>\n    <div class="datepicker picker-group" style="<%= dateDisplay %>">\n        <div class="picker-header">\n            <a href="javascript:;" class="minus" type="button" bx-click="_move(\'month\', -1)"><span class="brixfont">&#xe601;</span></a>\n            <!-- <button class="btn btn-default minus" type="button" bx-click="_move(\'month\', -1)"><span class="glyphicon glyphicon-step-backward"></span></button> -->\n            <h4 bx-click="_slide(\'.datepicker\', \'.monthpicker\')">?</h4>\n            <a href="javascript:;" class="plus" type="button" bx-click="_move(\'month\', 1)"><span class="brixfont">&#xe600;</span></a>\n            <!-- <button class="btn btn-default plus" type="button" bx-click="_move(\'month\', 1)"><span class="glyphicon glyphicon-step-forward"></span></button> -->\n        </div>\n        <div class="picker-body">\n            <div class="datepicker-body-description clearfix">\n                <span class="disabled">日</span><span class="disabled">一</span><span class="disabled">二</span><span class="disabled">三</span><span class="disabled">四</span><span class="disabled">五</span><span class="disabled">六</span>\n            </div>\n            <div class="datepicker-body-value picker-selectable clearfix">\n                <!-- <span class="inactive"></span> -->\n                <!-- <span data-value="1" class="active">01</span> -->\n                <!-- <span data-value="1">01</span> -->\n            </div>\n        </div>\n    </div>\n    <!-- 时分秒 -->\n    <% var timeDisplay = typeMap.time || typeMap.second || typeMap.minute || typeMap.hour  ? \'\': \'display: none;\' %>\n    <div class="timepicker picker-group clearfix" style="<%= timeDisplay %>">\n        <div class="timepicker-body clearfix">\n            <div class="timepicker-group">\n                <input class="form-control" type="text" tabindex="<%=options.clientId%>" bx-keydown="_changeHour()" bx-focusout="_changeHour()">\n                <button type="button" class="btn btn-default time-minus" bx-click="_changeHour(-1)"><span class="glyphicon glyphicon-minus"></span></button>\n                <button type="button" class="btn btn-default time-plus" bx-click="_changeHour(1)"><span class="glyphicon glyphicon-plus"></span></button>\n            </div>\n            <span class="timepicker-spliter">:</span>\n            <div class="timepicker-group">\n                <% var minuteDisabled = typeMap.hour && !typeMap.minute  ? \'disabled\': \'\' %>\n                <input class="form-control" type="text" tabindex="<%=options.clientId%>" bx-keydown="_changeMinute()" bx-focusout="_changeMinute()" <%= minuteDisabled %>>\n                <button type="button" class="btn btn-default time-minus" bx-click="_changeMinute(-1)" <%= minuteDisabled %>><span class="glyphicon glyphicon-minus"></span></button>\n                <button type="button" class="btn btn-default time-plus" bx-click="_changeMinute(1)" <%= minuteDisabled %>><span class="glyphicon glyphicon-plus"></span></button>\n            </div>\n            <span class="timepicker-spliter">:</span>\n            <div class="timepicker-group">\n                <% var secondDisabled = (typeMap.hour || typeMap.minute) && !typeMap.second  ? \'disabled\': \'\' %>\n                <input class="form-control" type="text" tabindex="<%=options.clientId%>" bx-keydown="_changeSecond()" bx-focusout="_changeSecond()" <%= secondDisabled %>>\n                <button type="button" class="btn btn-default time-minus" bx-click="_changeSecond(-1)" <%= secondDisabled %>><span class="glyphicon glyphicon-minus"></span></button>\n                <button type="button" class="btn btn-default time-plus" bx-click="_changeSecond(1)" <%= secondDisabled %>><span class="glyphicon glyphicon-plus"></span></button>\n            </div>\n        </div>\n        <div class="timepicker-footer">\n            <div class="timepicker-handelr">\n                <button class="btn btn-default submit" bx-click="_changeTime()">确认</button>\n                <a href="javascript: void(0);" class="btn btn-default cancel ml5">取消</a>\n            </div>\n        </div>\n    </div>\n    <!-- 不限 -->\n    <div class="picker-footer picker-group" style="<%= options.unlimit ? \'\' : \'display: none;\' %>">\n        <a href="javascript:;" bx-click="_unlimit()">不限</a>\n    </div>\n</div>'}.call(e,n,e,t),!(void 0!==i&&(t.exports=i))}])});
//# sourceMappingURL=datepicker.js.map
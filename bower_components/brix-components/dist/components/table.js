!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("jquery"),require("underscore"),require("components/base"),require("Sortable"),require("brix/event")):"function"==typeof define&&define.amd?define(["jquery","underscore","components/base","Sortable","brix/event"],e):"object"==typeof exports?exports["components/table"]=e(require("jquery"),require("underscore"),require("components/base"),require("Sortable"),require("brix/event")):t["components/table"]=e(t.jquery,t.underscore,t["components/base"],t.Sortable,t["brix/event"])}(this,function(t,e,n,i,r){return function(t){function e(i){if(n[i])return n[i].exports;var r=n[i]={exports:{},id:i,loaded:!1};return t[i].call(r.exports,r,r.exports,e),r.loaded=!0,r.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){t.exports=n(1)},function(t,e,n){var i,r;i=[n(2),n(3),n(4),n(5),n(6),n(8)],r=function(t,e,n,i,r,a){function o(){}var s=".table",c={UUID:0,COLUMN:{ID:"column-id",FIELD:"column-field",NAME:"column-name",RWD:{RANGE:"column-rwd-range",LIMIT:"column-rwd-limit",FADE:"column-rwd-fade",CURSOR:"column-rwd-cursor"},PRIORITY:{FIELDS:"column-priority-fields",TRIGGER:"column-priority-trigger",STATE:"column-priority-state",INDEX:"column-priority-index",PLACEMENT:"column-priority-placement",ALIGN:"column-priority-align"}}};return e.extend(o.prototype,n.prototype,{options:{},init:function(){this.$element=t(this.element)},render:function(){var n=this;i(this.element,function(t,e,i){n.trigger("toggle"+s,[e,i]),n.contextual()});var o,h;if(this.options[c.COLUMN.RWD.RANGE]){o=r(this,this.options,c,function(t,e){n.trigger("change"+r.NAMESPACE,[e])});var d="resize.table_"+this.clientId;t(window).on(d,e.throttle(function(){o.beautify()},50))}this.options[c.COLUMN.PRIORITY.TRIGGER]&&(h=a(this,this.options,c,function(t,e){n.trigger("change"+a.NAMESPACE,[e]),o.flush()}),this.options[c.COLUMN.PRIORITY.FIELDS]&&h.fields(this.options[c.COLUMN.PRIORITY.FIELDS])),this.columnRWDHandler=o,this.columnPriorityHandler=h},contextual:function(){e.each(this.$element.find("input:checkbox"),function(e){var n=t(e).prop("checked");t(e).closest("tr")[n?"addClass":"removeClass"]("active")})},destroy:function(){var e="resize.table_"+this.clientId;t(window).off(e),e="click"+a.NAMESPACE+"_"+this.clientId,t(document.body).off(e),this.columnPriorityHandler&&this.columnPriorityHandler.$manager.undelegate(this.columnPriorityHandler.$relatedElement)}}),o.extend=n.extend,o}.apply(e,i),!(void 0!==r&&(t.exports=r))},function(e,n){e.exports=t},function(t,n){t.exports=e},function(t,e){t.exports=n},function(t,e,n){var i,r;i=[n(2),n(3)],r=function(t,e){function n(e,s){var d=t(e),l="["+c+"],["+h+"]";return i(d,l),t(e).on("change.linkage",l,function(i){if(i.target===i.currentTarget){var c=t(i.currentTarget);r(c,d),a(c,d),o(c,d),s&&s(i,n.val(e),i.currentTarget)}}),n}function i(n,i){var r=n.find(i);e.each(r,function(e){var n=t(e);n.attr(c),n.attr(h)})}function r(n,i){var a=n.attr(c),o=n.attr(h);if(o&&a!==o){var s=i.find(e.template(d)({name:o}));if(s.length){var u=i.find(e.template(l)({name:o}));if(u.length){var f=u.filter(":checkbox"),p=[];e.each(f,function(t){p.push(!t.indeterminate&&t.checked)});var v=t(e.filter(f,function(t){return t.indeterminate})),m=u.filter(":radio"),g=e.uniq(e.map(m,function(e){return t(e).attr("name")})),b=[];e.each(g,function(t){t&&b.push(!!m.filter('[name="'+t+'"]:checked').length)});var I=e.uniq(p.concat(b));s.prop("indeterminate",!!v.length||2===I.length).prop("checked",!v.length&&(1===I.length&&I[0])),r(s,i)}}}}function a(n,i){var r=n.attr(c),o=n.attr(h),s=n.prop("checked");if(r&&r!==o){var d=i.find(e.template(l)({name:r}));if(d.length){var u=d.not(":disabled");if(u.length){var f=u.filter(":checkbox");f.prop("checked",s);var p=u.filter(":radio");if(s||p.prop("checked",s),s){var v=e.uniq(e.map(p,function(e){return t(e).attr("name")}));e.each(v,function(n){if(n){var i=p.filter('[name="'+n+'"]');if(i.length){var r=e.map(i,function(e){return t(e).prop("checked")});e.indexOf(r,s)===-1&&i.eq(0).prop("checked",s)}}})}e.each(d,function(e){a(t(e),i)})}}}}function o(n,i){if(n.is(":radio")){var o=n.attr("name"),s=i.find('[name="'+o+'"]').not(n);e.each(s,function(e){var n=t(e);r(n,i),a(n,i)})}}var s="data-linkage-",c=s+"name",h=s+"parent-name",d="["+c+'="<%= name %>"]',l="["+h+'="<%= name %>"]';return n.off=function(e){var i=t(e),r="["+c+"],["+h+"]";return i.off("click.linkage",r),n},n.val=function(i,o){var s=t(i);if(o){var c=s.find("input:checkbox, input:radio").not(":disabled").prop("checked",!1);return e.each(o,function(n){var i=c.filter('[value="'+n+'"]').prop("checked",!0);e.each(i,function(e){r(t(e),s),a(t(e),s)})}),n}o=[];var h=s.find("input:checkbox:checked, input:radio:checked");return e.each(h,function(e){var n=t(e).attr("value");void 0!==n&&""!==n&&o.push(n)}),o},n}.apply(e,i),!(void 0!==r&&(t.exports=r))},function(t,e,n){var i,r;i=[n(2),n(3),n(7)],r=function(t,e,n){function i(e,n,i,a){var h=n[i.COLUMN.RWD.RANGE]||[0,-1],d=n[i.COLUMN.RWD.CURSOR]||1,l=n[i.COLUMN.RWD.LIMIT]||5,u=n[i.COLUMN.RWD.FADE]||!1,f=t(e.element),p=s(i,f,h,d,l),v=r(f,'<span class="brixfont chevron-left">&#xe62f;</span>'),m=r(f,'<span class="brixfont chevron-right">&#xe630;</span>'),g={Constant:i,$table:f,range:h,cursor:d,limit:l,fade:u,state:p,$leftArrow:v,$rightArrow:m,callback:a};return o(g),setTimeout(function(){c(g)},100),{state:p,flush:function(t){return s(i,f,h,t||d,l,p),c(g),this},beautify:function(){return c(g),this}}}function r(n,i){var r=n.find("> thead"),a=e.template(d)({text:i,height:r.height()}),o=t(a).insertAfter(n).offset({top:r.offset().top});return o}function a(t,e){s(e.Constant,e.$table,e.range,e.state.cursor,e.state.limit,e.state),c(e),t.preventDefault(),t.stopPropagation()}function o(e){e.$leftArrow.on("click"+h,function(t){e.state.moveToPrev(),a(t,e),e.callback&&e.callback(t,e.state,t.currentTarget)}),e.$rightArrow.on("click"+h,function(t){e.state.moveToNext(),a(t,e),e.callback&&e.callback(t,e.state,t.currentTarget)}),e.fade?e.$table.hover(function(){e.$leftArrow.fadeIn("fast"),e.$rightArrow.fadeIn("fast"),c(e)},function(n){n.relatedTarget===e.$leftArrow.get(0)||t.contains(e.$leftArrow.get(0),n.relatedTarget)||n.relatedTarget===e.$rightArrow.get(0)||t.contains(e.$rightArrow.get(0),n.relatedTarget)||(e.$leftArrow.fadeOut("fast"),e.$rightArrow.fadeOut("fast"))}):(e.$leftArrow.show(),e.$rightArrow.show(),c(e))}function s(i,r,a,o,s,c){var h=r.find("> thead"),d=r.find("> tbody"),l=h.find("> tr > th");a[0]=(+a[0]+l.length)%l.length,a[1]=(+a[1]+l.length)%l.length,e.each(l,function(e,n){if(e=t(e),n>=a[0]&&n<a[1]){if(void 0!==e.data(i.COLUMN.ID))return;e.attr("data-"+i.COLUMN.ID,i.UUID++)}}),l=e.filter(l,function(t,e){return e>=a[0]&&(0===a[1]||e<a[1])});var f=t(l[0]).prev();l.sort(function(e,n){var r=t(e),a=t(n);return e=+r.attr("data-"+i.COLUMN.PRIORITY.INDEX),n=+a.attr("data-"+i.COLUMN.PRIORITY.INDEX),isNaN(e)&&(e=r.index()),isNaN(n)&&(n=a.index()),e-n}),e.each(l,function(n,i){var r=t(n).index();0===i?f.after(n):t(l[i-1]).after(n);var a=t(n).index(),o=d.find("> tr > td:nth-child("+(r+1)+")");e.each(o,function(e,n){t(e).siblings(":nth-child("+a+")").after(e)})}),l=e.filter(l,function(e){var n=t(e),r=n.data(i.COLUMN.ID),a=n.attr("data-"+i.COLUMN.PRIORITY.STATE);return void 0!==r&&"hide"!==a}),l=t(l),c?(c.setTotal(l.length),c.setCursor(o)):c=new n(l.length,o,s);for(var p,v,m=0;m<c.total;m++)p=m>=c.start&&m<c.end?"show":"hide",v=l.eq(m)[p]().removeClass("start").removeClass("end").addClass(m===c.start?"start":"").addClass(m===c.end-1?"end":"").index(),r.find(e.template(u)({nth:v+1}))[p]();return c}function c(t){t.fade||(t.$leftArrow.show(),t.$rightArrow.show());var n=t.$table.find("> thead"),i=n.height(),r=n.offset().top,a=t.$table.find(e.template(l)({nth:t.range[1]+1}));t.$leftArrow.css({height:i,"line-height":i+"px"}).offset({top:r,left:a.offset().left-t.$rightArrow.width()-(t.state.hasNext?t.$leftArrow.width():0)}),t.$rightArrow.css({height:i,"line-height":i+"px"}).offset({top:r,left:a.offset().left-t.$rightArrow.width()}),t.state.total&&t.state.hasPrev||t.$leftArrow.hide(),t.state.total&&t.state.hasNext||t.$rightArrow.hide()}var h=".table_column_rwd",d='<div class="column-scroll-arrow"><%= text %></div>',l="> thead > tr > th:nth-child(<%= nth %>)",u="> tbody > tr > td:nth-child(<%= nth %>)";return i.NAMESPACE=h,i}.apply(e,i),!(void 0!==r&&(t.exports=r))},function(t,e,n){var i;i=function(){return function(e){function n(t,e,n){this.data="number"==typeof t||"string"==typeof t?void 0:t,this.total=this.data?this.data.length:parseInt(t,10),this.cursor=parseInt(e,10),this.limit=parseInt(n,10),this.calc()}return n.prototype={calc:function(){return this.total&&parseInt(this.total,10)>0?(this.limit=this.limit<1?1:this.limit,this.pages=this.total%this.limit===0?this.total/this.limit:this.total/this.limit+1,this.pages=parseInt(this.pages,10),this.cursor=this.cursor>this.pages?this.pages:this.cursor,this.cursor=this.cursor<1?this.pages>0?1:0:this.cursor,this.start=(this.cursor-1)*this.limit,this.start=this.start<0?0:this.start,this.end=this.start+this.limit>this.total?this.total:this.start+this.limit,this.end=this.total<this.limit?this.total:this.end,this.hasPrev=this.cursor>1,this.hasNext=this.cursor<this.pages,this.hasFirst=this.hasPrev,this.hasLast=this.hasNext,this.prev=this.hasPrev?this.cursor-1:0,this.next=this.hasNext?this.cursor+1:0,this.first=this.hasFirst?1:0,this.last=this.hasLast?this.pages:0,this.focus=this.focus?this.focus:0,this.focus=this.focus%this.limit+this.start,this.focus=this.focus>this.end-1?this.end-1:this.focus):(this.pages=this.cursor=this.start=this.end=0,this.hasPrev=this.hasNext=this.hasFirst=this.hasLast=!1,this.prev=this.next=this.first=this.last=0,this.focus=0),this},moveTo:function(t){return this.cursor=parseInt(t,10),this.calc()},moveToPrev:function(){return this.moveTo(this.cursor-1)},moveToNext:function(){return this.moveTo(this.cursor+1)},moveToFirst:function(){return this.moveTo(1)},moveToLast:function(){return this.moveTo(this.pages)},fetch:function(t){return(t||this.data).slice(this.start,this.end)},setData:function(t){return this.data=t,this.total=t.length,this.calc()},setTotal:function(t){return this.total=parseInt(t,10),this.calc()},setCursor:function(t){return this.cursor=parseInt(t,10),this.calc()},setFocus:function(t){return this.focus=parseInt(t,10),this.focus<0&&(this.focus+=this.total),this.focus>=this.total&&(this.focus-=this.total),this.cursor=parseInt(this.focus/this.limit,10)+1,this.calc()},setLimit:function(t){return this.limit=parseInt(t,10),this.calc()},get:function(t){return void 0!==t?this.data[t%this.data.length]:this.data[this.focus]},toString:function(){return JSON.stringify(this,null,4)}},n.prototype.to=n.prototype.moveTo,n.prototype.toPrev=n.prototype.moveToPrev,n.prototype.toNext=n.prototype.moveToNext,n.prototype.toFirst=n.prototype.moveToFirst,n.prototype.toLast=n.prototype.moveToLast,"undefined"!=typeof t&&t.exports?t.exports=n:e.State=n,n}(this)}.call(e,n,e,t),!(void 0!==i&&(t.exports=i))},function(t,e,n){var i,r;i=[n(2),n(3),n(9),n(10),n(11),n(12)],r=function(t,e,n,i,r,a){function o(i,r,a,o){var c=t(r[a.COLUMN.PRIORITY.TRIGGER]),p=r[a.COLUMN.PRIORITY.PLACEMENT]||"bottom",m=r[a.COLUMN.PRIORITY.ALIGN]||"right",g=t(i.element),b=s(a,g);l(c,b,p,m),f(i,c,b);var I=u(a,g,c,b,o),x=b.find(".queue .sortable-wrapper");return x.length&&n.create(x[0],{handle:".item-move",animation:150,onEnd:function(){var n={},i=b.find(".queue .sortable-wrapper .item");e.each(i,function(e,i){var r=t(e),o=r.data(a.COLUMN.ID);n[o]=i,r.attr("data-"+a.COLUMN.PRIORITY.INDEX,i)});var r=g.find("> thead th");e.each(r,function(e){var i=t(e),r=i.data(a.COLUMN.ID);void 0!==r&&i.attr("data-"+a.COLUMN.PRIORITY.INDEX,n[r])})}}),b.on("change"+v,"input:checkbox",function(e){var n=t(e.target),i=n.data(a.COLUMN.ID),r=n.prop("checked");b.find(".queue .sortable-wrapper .item").filter("[data-"+a.COLUMN.ID+'="'+i+'"]')[r?"slideDown":"slideUp"]("fast")}),{$relatedElement:b,$manager:I,toggle:function(){b.toggle()},show:function(){b.show()},hide:function(){b.hide()},fields:function(n){if(n){var i=b.find(".candidates input:checkbox"),r=b.find(".queue .sortable-wrapper .item"),s=[];return e.each(i,function(i){var o=t(i),c=o.data(a.COLUMN.FIELD),h=e.indexOf(n,c);o.prop("checked",h!==-1).triggerHandler("change"+v);var d=r.filter("[data-"+a.COLUMN.FIELD+'="'+c+'"]');h===-1?d.hide():(d.show(),s[h]=d)}),e.each(s,function(e,n){e&&(0===n?t(e).parent().prepend(e):s[n-1].after(e))}),h(a,g,b),o&&o(void 0,n),this}return d(a,b)}}}function s(n,i){var r=p(n,i),o=e.template(a)(r),s=t(o).insertAfter(i);return s}function c(t,e,n,i){var a=r(t,e,n,i),o=parseInt(e.css("margin-left"),10)||0,s=parseInt(e.css("margin-top"),10)||0;return{left:a.left+o,top:a.top+s}}function h(n,i,r){var a=r.find(".candidates input:checkbox");return e.each(a,function(e){var r=t(e),a=r.data(n.COLUMN.ID);if(void 0!==a){var o=r.prop("checked"),s=o?"show":"hide",c=i.find("> thead th[data-"+n.COLUMN.ID+'="'+a+'"]').attr("data-"+n.COLUMN.PRIORITY.STATE,s)[s]();i.find("> tbody td:nth-child("+(c.index()+1)+")").attr("data-"+n.COLUMN.PRIORITY.STATE,s)[s]()}}),d(n,r)}function d(n,i){var r=[],a=i.find(".queue .sortable-wrapper .item");return e.each(a,function(e){var i=t(e);"none"!==i.css("display")&&r.push(i.data(n.COLUMN.FIELD)||i.data(n.COLUMN.NAME))}),r}function l(e,n,i,r){e.on("click"+v,function(){return n.is(":visible")?(n.hide(),void t(document.body).removeClass("modal-open")):void n.show().offset(c(e,n,i,r))})}function u(t,e,n,r,a){var o=new i("bx-"),s={submit:function(n){var i=h(t,e,r);a&&a(n,i,n.currentTarget),r.hide()},cancel:function(){r.hide()},all:function(){r.find(".candidates input:checkbox").prop("checked",!0),r.find(".queue .sortable-wrapper .item").show()},clear:function(){r.find(".candidates input:checkbox").prop("checked",!1),r.find(".queue .sortable-wrapper .item").hide()}};return o.delegate(r,s),o}function f(e,n,i){var r="click"+v+"_"+e.clientId;t(document.body).off(r).on(r,function(e){!n[0]||e.target===n[0]||t.contains(n[0],e.target)||e.target===i[0]||t.contains(i[0],e.target)||(t(document.body).removeClass("modal-open"),i.hide())})}function p(n,i){var r=i.find("> thead th"),a=!1,o=[],s=[],c=e.map(r,function(e,i){var r=t(e),c=r.data(n.COLUMN.NAME);if(c||(c=t.trim(r.text()),r.attr("data-"+n.COLUMN.NAME,c)),c)return void 0===r.data(n.COLUMN.ID)?void(a?s:o).push({index:i,name:c}):(a=!0,{index:i,id:r.data(n.COLUMN.ID),name:c,field:r.data(n.COLUMN.FIELD)||c})});return c=e.filter(c,function(t){return!!t}),{Constant:n,candidates:c,leftImmovables:o,rightImmovables:s}}var v=".table_column_priority";return o.NAMESPACE=v,o}.apply(e,i),!(void 0!==r&&(t.exports=r))},function(t,e){t.exports=i},function(t,e){t.exports=r},function(t,e,n){var i,r;i=[n(2)],r=function(t){function e(e,i,r,s){var c=t(e);if(!c.length)return n(i);var h=c.offset(),d=h.left,l=h.top,u=c.outerWidth(),f=c.outerHeight(),p=t(i),v="none"!==p.css("display");p.show();var m=p.outerWidth(),g=p.outerHeight();v||p.hide();var b,I,x=u/2-m/2,N=f/2-g/2;switch(r){case"top":b=d+x,I=l-g;break;case"bottom":b=d+x,I=l+f;break;case"left":b=d-m,I=l+N;break;case"right":b=d+u,I=l+N}if(a.test(r)!==a.test(s)&&o.test(r)!==o.test(s))switch(s){case"top":I=l;break;case"bottom":I=l+f-g;break;case"left":b=d;break;case"right":b=d+u-m}return{left:b,top:I}}function n(e,n){var i,r;if(n)i=parseFloat(e,12),r=parseFloat(n,12);else{var a=t(e),o="none"!==a.css("display");a.show(),i=a.outerWidth(),r=a.outerHeight(),o||a.hide()}var s=t(window),c=s.width(),h=s.height(),d=s.scrollLeft(),l=s.scrollTop();return{left:c/2-i/2+d,top:h/2-r/2+l}}function i(e,n,i){var r=t(e),a="none"!==r.css("display");r.show();var o=r.outerWidth(),s=r.outerHeight();a||r.hide();var c={opacity:0,left:n.left,top:n.top};switch(i){case"top":c.top=c.top-.5*s;break;case"bottom":c.top=c.top+.5*s;break;case"left":c.left=c.left-.5*o;break;case"right":default:c.left=c.left+.5*o}return c}function r(t,e){return{opacity:1,left:e.left,top:e.top}}var a=/top|bottom/,o=/left|right/;return e.center=n,e.start=i,e.end=r,e}.apply(e,i),!(void 0!==r&&(t.exports=r))},function(t,e,n){var i;i=function(){return'<div class="dialog column-priority">\n    <div class="dialog-content">\n        <div class="dialog-header row">\n            <div class="col-xs-8">\n                <h4>\n                    <span>请选择列</span>\n                    <small>\n                        <a href="javascript: void(0);" bx-click="all">全选</a>\n                        <a href="javascript: void(0);" bx-click="clear">清空</a>\n                    </small>\n                </h4>\n            </div>\n            <div class="col-xs-4">\n                <h4>自定义列顺序</h4>\n            </div>\n        </div>\n        <div class="dialog-body row">\n            <div class="col-xs-8 candidates">\n                <% for ( var i = 0; i < candidates.length; i++ ) { %>\n                <label class="item">\n                    <input type="checkbox" \n                        data-<%= Constant.COLUMN.ID %>="<%= candidates[i].id %>" \n                        data-<%= Constant.COLUMN.NAME %>="<%= candidates[i].name %>" \n                        data-<%= Constant.COLUMN.FIELD %>="<%= candidates[i].field %>" \n                        data-<%= Constant.COLUMN.PRIORITY.INDEX %>="<%= candidates[i].index %>" \n                        checked>\n                    <span title="<%= candidates[i].name %>"><%= candidates[i].name %></span>\n                </label>\n                <% } %>\n            </div>\n            <div class="col-xs-4 queue">\n                <!-- immovables -->\n                <div>\n                    <% for( var i = 0; i < leftImmovables.length; i++ ) { %>\n                    <div class="item item-not-allowed">\n                        <span><%= leftImmovables[i].name %></span>\n                    </div>\n                    <% } %>\n                </div>\n                <div class="sortable-wrapper">\n                    <% for ( var i = 0; i < candidates.length; i++ ) { %>\n                    <div class="item item-move" \n                        data-<%= Constant.COLUMN.ID %>="<%= candidates[i].id %>" \n                        data-<%= Constant.COLUMN.NAME %>="<%= candidates[i].name %>" \n                        data-<%= Constant.COLUMN.FIELD %>="<%= candidates[i].field %>" \n                        data-<%= Constant.COLUMN.PRIORITY.INDEX %>="<%= candidates[i].index %>">\n                        <span class="item-name" title="<%= candidates[i].name %>"><%= candidates[i].name %></span>\n                    </div>\n                    <% } %>\n                </div>\n                <div>\n                    <% for( var i = 0; i < rightImmovables.length; i++ ) { %>\n                    <div class="item item-not-allowed">\n                        <span><%= rightImmovables[i].name %></span>\n                    </div>\n                    <% } %>\n                </div>\n            </div>\n        </div>\n        <div class="dialog-footer">\n            <button bx-click="submit" class="btn btn-default btn-sm">确定</button>\n            <a bx-click="cancel" href="javascript: void(0);">取消</a>\n        </div>\n    </div>\n</div>'}.call(e,n,e,t),!(void 0!==i&&(t.exports=i))}])});
//# sourceMappingURL=table.js.map
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("jquery"),require("underscore"),require("components/base"),require("brix/event")):"function"==typeof define&&define.amd?define(["jquery","underscore","components/base","brix/event"],t):"object"==typeof exports?exports["components/tree"]=t(require("jquery"),require("underscore"),require("components/base"),require("brix/event")):e["components/tree"]=t(e.jquery,e.underscore,e["components/base"],e["brix/event"])}(this,function(__WEBPACK_EXTERNAL_MODULE_2__,__WEBPACK_EXTERNAL_MODULE_3__,__WEBPACK_EXTERNAL_MODULE_4__,__WEBPACK_EXTERNAL_MODULE_5__){return function(e){function t(i){if(n[i])return n[i].exports;var o=n[i]={exports:{},id:i,loaded:!1};return e[i].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){e.exports=n(1)},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(2),__webpack_require__(3),__webpack_require__(4),__webpack_require__(5),__webpack_require__(6),__webpack_require__(7)],__WEBPACK_AMD_DEFINE_RESULT__=function($,_,Brix,EventManager,template,nodeTemplate){function toTree(e){var t={};_.each(e,function(e){e&&e.id&&(t[e.id]=e)});var n=[];return _.each(e,function(e){if(e){if(void 0==e.pid&&void 0==e.parentId)return void n.push(e);var i=t[e.pid]||t[e.parentId];i&&(i.children||(i.children=[]),i.children.push(e))}}),n}function Tree(){}function fix(e,t,n){e.contentFn=function(e){return e.content||_.template(n)(e)},e.childrenFn=function(){return this.children&&this.children.length?_.template(t)(this):""},_.each(e.children,function(e){fix(e,t,n)})}var NAMESPACE=".tree",STATE={PENDING:"pending",ACTIVE:"active",INACTIVE:"inactive"};return _.extend(Tree.prototype,Brix.prototype,{options:{data:void 0,nodeTemplate:void 0,state:"expand"},init:function(){var that=this,defer=$.Deferred(),deps=[],customNodeTemplate=this.options.nodeTemplate||this.options["node-template"];if(customNodeTemplate&&deps.push(customNodeTemplate),window.require(deps,function(){customNodeTemplate&&(that.options.customNodeTemplate=arguments[0]),defer.resolve()}),!this.options.data){$(this.element).find("script").remove();var text=$.trim(this.element.innerHTML);this.options.data=eval("(function(){ return Array.prototype.slice.call(arguments)[0] })("+text+")"),this.element.innerHTML=""}var mapped={};if(_.each(this.options.data,function(e){e&&e.id&&(null!=e.pid&&null==e.parentId&&(e.parentId=e.pid),null==e.pid&&null!=e.parentId&&(e.pid=e.parentId),mapped[e.id]=e)}),this.options.mapped=mapped,this.options.data={id:"root",name:"root",children:toTree(this.options.data)},deps.length)return defer.promise()},render:function(){var e=this,t=new EventManager;this.$element=$(this.element),fix(this.options.data,template,this.options.customNodeTemplate||nodeTemplate),this.$element.append(_.template(template)(this.options.data)),t.delegate(this.$element,this),"collapse"===this.options.state&&this.collapse(),"expand"===this.options.state&&this.expand();var n="click"+NAMESPACE+"_"+this.clientId;this._state=STATE.INACTIVE,$(document.body).off(n).on(n,function(t){if(t.target===e.element||$.contains(e.element,t.target)||!t.target.parentNode){if(e._state===STATE.ACTIVE)return;return e.trigger($.Event("active"+NAMESPACE,{target:t.target})),void(e._state=STATE.ACTIVE)}e._state!==STATE.INACTIVE&&(e.trigger($.Event("inactive"+NAMESPACE,{target:t.target})),e._state=STATE.INACTIVE)})},toggle:function(e,t){e.stopPropagation();var n;n=void 0===e?"li[data-node-id]":e.type?'li[data-node-id="'+t+'"]':'li[data-node-id="'+e+'"]',$(n,this.$element).find("> .tree-node-control .brixfont").toggle().end().find("> ul.tree").slideToggle("fast")},expand:function(e){var t;t=void 0===e?"li[data-node-id]":'li[data-node-id="'+e+'"]';var n=this.options.mapped;void 0!==e&&n[e]&&n[e].parentId&&this.expand(n[e].parentId);var i=$(t,this.$element).show().find("> .tree-node-control .brixfont.plus-sign").hide().end().find("> .tree-node-control .brixfont.minus-sign").show().end();void 0===e?i.find("> ul.tree").show():i.find("> ul.tree").slideDown("fast")},collapse:function(e){var t;t=void 0===e?"li[data-node-id]":'li[data-node-id="'+e+'"]';var n=$(t,this.$element).show().find("> .tree-node-control .brixfont.plus-sign").show().end().find("> .tree-node-control .brixfont.minus-sign").hide().end();void 0===e?n.find("> ul.tree").hide():n.find("> ul.tree").slideUp("fast")},search:function(e){function t(e,n){_.each(e.children,function(e){n.push(e),t(e,n)})}function n(e,t){var n=new RegExp(t,"ig");_.each($(".tree-node-content-name",e),function(e){var t=$(e);t.html(t.text().replace(n,function(e){return'<span class="highlight">'+e+"</span>"}))})}if(void 0!==e){var i=this;$("li[data-node-id]",this.$element).hide();var o=[];_.each(this.options.mapped,function(n){n.name.toLowerCase().indexOf(e.toLowerCase())!==-1&&(o.push(n),t(n,o))}),_.each(_.uniq(o),function(e){i.expand(e.id)}),n(this.$element,e)}},current:function(e){if(e){var t,n=this.options.mapped,i={},o=e.jquery?e.attr("data-node-id"):e.nodeType?$(e).attr("data-node-id"):e;if(o&&n[o])return t='li[data-node-id="'+o+'"]',i.data=n[o],i.element=$(t,this.$element).find("> .tree-node-control > .tree-node-content")[0],i}},parent:function(e){if(e){var t,n,i=this.options.mapped,o={},r=e.jquery?e.attr("data-node-id"):e.nodeType?$(e).attr("data-node-id"):e;if(r&&i[r]&&i[r].parentId&&i[i[r].parentId])return t=i[r].parentId,n='li[data-node-id="'+t+'"]',o.data=i[t],o.element=$(n,this.$element).find("> .tree-node-control > .tree-node-content")[0],o}},children:function(e){if(e){var t,n=this,i=this.options.mapped,o=[],r=e.jquery?e.attr("data-node-id"):e.nodeType?$(e).attr("data-node-id"):e;return r&&i[r]&&i[r].children&&i[r].children.length?(_.each(i[r].children,function(e){t='li[data-node-id="'+e.id+'"]',o.push({data:i[e.id],element:$(t,n.$element).find("> .tree-node-control > .tree-node-content")[0]})}),o):o}},siblings:function(e){if(e){var t=this,n=this.options.mapped,i=e.jquery?e.attr("data-node-id"):e.nodeType?$(e).attr("data-node-id"):e,o=this.parent(e),r=[];if(o)r=this.children(o.element);else{if(!i||!n[i])return[];var d,a=n[i].parentId;_.each(n,function(e){e.parentId===a&&(d='li[data-node-id="'+e.id+'"]',r.push({data:e,element:$(d,t.$element).find("> .tree-node-control > .tree-node-content")[0]}))})}var s=[];return _.each(r,function(e){e.data.id!==i&&s.push(e)}),s}},all:function(){var e,t=this,n=this.options.mapped,i=[];return _.each(n,function(o){e='li[data-node-id="'+o.id+'"]',i.push({data:n[o.id],element:$(e,t.$element).find("> .tree-node-control > .tree-node-content")[0]})}),i},forward:function(e,t){e.stopPropagation();var n=$.Event(e.type+NAMESPACE,{target:e.target,currentTarget:e.currentTarget});this.trigger(n,[this.options.mapped[t],e.currentTarget])},destroy:function(){var e="click"+NAMESPACE+"_"+this.clientId;$(document.body).off(e)}}),Tree}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))},function(e,t){e.exports=__WEBPACK_EXTERNAL_MODULE_2__},function(e,t){e.exports=__WEBPACK_EXTERNAL_MODULE_3__},function(e,t){e.exports=__WEBPACK_EXTERNAL_MODULE_4__},function(e,t){e.exports=__WEBPACK_EXTERNAL_MODULE_5__},function(e,t,n){var i;i=function(){return'<ul class="tree">\n    <% for(var i = 0, item; item = children[i]; i++ ) { %>\n        <li data-node-id="<%= item.id %>" class="tree-node <%= item.children && item.children.length ? \'\': \'tree-leaf\' %>">\n            <div class="tree-node-control clearfix">\n                <div class="tree-node-toggle" bx-click="toggle(\'<%= item.id %>\')">\n                    <span class="brixfont plus-sign">&#xe61f;</span>\n                    <span class="brixfont minus-sign">&#xe620;</span>\n                </div>\n                <div data-node-id="<%= item.id %>" class="tree-node-content" bx-click="forward(\'<%= item.id %>\')" bx-mouseenter="forward(\'<%= item.id %>\')" bx-mouseleave="forward(\'<%= item.id %>\')">\n                    <%= contentFn(item) %>\n                </div>\n            </div>\n            <%= item.childrenFn() %>\n        </li>\n    <% } %>\n</ul>'}.call(t,n,t,e),!(void 0!==i&&(e.exports=i))},function(e,t,n){var i;i=function(){return'<span class="tree-node-content-name"><%= name %></span>'}.call(t,n,t,e),!(void 0!==i&&(e.exports=i))}])});
//# sourceMappingURL=tree.js.map
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("jquery"),require("underscore"),require("brix/loader"),require("components/base")):"function"==typeof define&&define.amd?define(["jquery","underscore","brix/loader","components/base"],t):"object"==typeof exports?exports["components/uploader"]=t(require("jquery"),require("underscore"),require("brix/loader"),require("components/base")):e["components/uploader"]=t(e.jquery,e.underscore,e["brix/loader"],e["components/base"])}(this,function(e,t,n,r){return function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={exports:{},id:r,loaded:!1};return e[r].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){e.exports=n(1)},function(e,t,n){var r,o;r=[n(2),n(3),n(4),n(5)],o=function(e,t,n,r){function o(){return("token"+Math.random()).replace(/\D/g,"")}function i(){}var s='<input name="<%= name %>" type="file" class="uploader-ghost">',a="data-token",p="["+a+"]",c=".uploader";return i.burn=function(t){var n=e(t);n.replaceWith(n.clone(!0,!0).attr(a,o()).prop("clientId",n.prop("clientId")))},i.transports={iframe:function(n,r){var o=e.Deferred(),s="FILE_UPLOAD_IFRAME_",a='<iframe id="<%= id %>" name="<%= id %>" style="display: none;"></iframe>';r.target=s+t.uniqueId(),r.action=n.action,r.method="POST",r.enctype="multipart/form-data";var p=t.template(a)({id:r.target});return e(p).insertAfter(r).on("load",function(t){var n=t.target,r=e((n.contentWindow||n.contentDocument).document.body),s=r.find("#result"),a=e.trim(s.length?s.text():r.text());i.parseJSONResponse(a,function(e,t){e?o.reject(e):o.resolve(t)}),e(n).remove()}).on("error",function(e){o.reject(e)}),r.submit(),o.promise()},xhr:function(n,r,o){var s=e.Deferred(),a=new FormData;t.each(o.files,function(e){a.append(n.name,e)});var p=new XMLHttpRequest;return p.overrideMimeType("application/json"),p.open("post",n.action,!0),p.upload.onprogress=function(e){e.percent=Math.round(e.loaded/e.total*100),s.notify(e)},p.onload=function(){var e=p.responseText;i.parseJSONResponse(e,function(e,t){e?s.reject(e):s.resolve(t)})},p.onerror=function(e){s.reject(e)},p.onabort=function(){s.reject("canceled")},p.ontimeout=function(){s.reject("timeout")},p.send(a),s.promise()}},i.parseJSONResponse=function(e,t){try{t(void 0,JSON.parse(e))}catch(n){try{t(void 0,new Function("return "+e)())}catch(r){t(r,e)}}finally{}},i.readFileAsDataURL=function(e,t){var n=new FileReader;n.onload=function(e){t(e.target.result)},n.readAsDataURL(e)},t.extend(i.prototype,r.prototype,{options:{action:"",name:"file",transport:"iframe",multiple:!0,accept:""},render:function(){this.$element=e(this.element),this.$element.parent().css("position","relative");var r=e(t.template(s)(this.options)).attr(a,o()).prop("clientId",this.options.clientId).prop("disabled",this.$element.prop("disabled")).insertAfter(this.$element).width(this.$element.outerWidth()).height(this.$element.outerHeight()).offset(this.$element.offset());this.options.multiple&&r.attr("multiple","multiple"),this.options.accept&&r.prop("accept",this.options.accept);var u=r[0].form;e(u).off("change"+c).on("change"+c,"input[type=file]"+p,function(t){var r=t.currentTarget,o=n.query(r)[0],s=e.Event("start"+c);return o.trigger(s,[r.files]),s.isDefaultPrevented()?void i.burn(r):void o.send(u,r).then(function(e){o.trigger("success"+c,[r.files,e])},function(e){o.trigger("error"+c,[r.files,e])},function(e){o.trigger("progress"+c,[r.files,e])}).always(function(){try{o.trigger("complete"+c,[r.files])}finally{i.burn(r)}})})},send:function(e,t){return i.transports[this.options.transport](this.options,e,t)}}),i}.apply(t,r),!(void 0!==o&&(e.exports=o))},function(t,n){t.exports=e},function(e,n){e.exports=t},function(e,t){e.exports=n},function(e,t){e.exports=r}])});
//# sourceMappingURL=uploader.js.map
define(["jquery","underscore","moment","brix/base","./countdown.tpl.js","css!./countdown.css"],function(t,e,s,i,n){function o(){}e.extend(o.prototype,i.prototype,{options:{precision:500,expires:new Date},render:function(){this.options.expires=s(this.options.expires).toDate(),this.data=this.data||e.extend({},this.options);var i=e.template(n)(this.data),o=t(this.element);o.append(i),this.start()},start:function(){function e(){var t=s.update();return 0===t.total&&(r.pop(s.task,s.options.precision),s.trigger("complete.countdown",t)),e}var s=this;return this.trigger("start.countdown",this.offset()),this.task=e,this.on("complete.countdown",function(){t(s.element).addClass("is-complete")}),r.push(e(),this.options.precision),this},stop:function(){return this.options.expires=new Date,r.pop(this.task(),this.options.precision),this},pause:function(){return this.trigger("pause.countdown",this.offset()),r.pop(this.task,this.options.precision),this},resume:function(){return this.trigger("resume.countdown",this.offset()),r.push(this.task(),this.options.precision),this},update:function(){function e(t,e){switch(e=e||2){case 2:return 10>t?"0"+t:t;case 3:return 10>t?"00"+t:100>t?"0"+t:t}}var s=this.offset();return t(this.element).find(".totalDays").text(e(s.totalDays)).end().find(".hours").text(e(s.hours)).end().find(".minutes").text(e(s.minutes)).end().find(".seconds").text(e(s.seconds)).end(),this.trigger("update.countdown",s),s},offset:function(){var t=this.options.expires,e=t.getTime()-(new Date).getTime();e=Math.ceil(e/1e3),e=0>e?0:e;var s={total:e,seconds:e%60,minutes:Math.floor(e/60)%60,hours:Math.floor(e/60/60)%24,days:Math.floor(e/60/60/24)%7,totalDays:Math.floor(e/60/60/24),weeks:Math.floor(e/60/60/24/7),months:Math.floor(e/60/60/24/30),years:Math.floor(e/60/60/24/365)};return s}});var r={push:function(t,e){this.timers=this.timers||{},this.timers[e]=this.timers[e]||[],this.timers[e].push(t),this.run()},pop:function(t,e){var s=this.timers;if(s&&s[e])for(var i=0;i<s[e].length;i++)s[e][i]===t&&s[e].splice(i--,1)},run:function(){e.each(this.timers,function(t,s){return t.length?void(t.timer||(t.timer=setInterval(function(){e.each(t,function(t){t()})},s))):void clearInterval(t.timer)})}};return o});
define(["jquery","underscore","components/base","css!./editable.css"],function(t,e,i){function n(){}var s=".editable",o={pre:"<textarea>",_default:'<input type="text">'};return e.extend(n.prototype,i.prototype,{options:{type:"text",content:""},init:function(){var e=this.options.type;this.$element=t(this.element),this.options.content||(this.options.content=this.$element[e]()),this.$element[e]()||this.$element[e](this.options.content)},render:function(){var e=this,i=this.$element.is("pre")?o.pre:o._default;this.$relatedElement=t(i).val(this.options.content).insertAfter(this.$element),this._beautify(),this.$relatedElement.hide(),this.$element.on("click",function(){e.show()}),this.$relatedElement.on("keydown",function(t){e._hooks[t.which]&&e._hooks[t.which].call(e,t)}).on("blur",function(){e.update()!==!1&&e.hide()})},update:function(){var e=this.$element[this.options.type]()||this.options.content,i=this.$relatedElement.val();if(e!==i){var n=t.Event("change"+s);return this.trigger(n,[i]),n.isDefaultPrevented()?!1:void this.$element[this.options.type](i)}},show:function(){this._beautify(),this.$element.hide(),this.$relatedElement.show().focus()},hide:function(){this.$relatedElement.hide(),this.$element.show()},_hooks:{13:function(t){t.preventDefault(),this.update()!==!1&&this.hide()},27:function(t){t.preventDefault(),this.hide(),this.$relatedElement.val(this.$element[this.options.type]())}},_bind:function(){},_beautify:function(){var t=this.$element,e=this.$relatedElement,i=t.css("display"),n=t.css("z-index"),s=t.outerWidth(!0),o=parseInt(t.css("padding-left"),10)||0,h=parseInt(t.css("padding-right"),10)||0,r=parseInt(t.css("border-left-width"),10)||0,l=parseInt(t.css("border-right-width"),10)||0,a=parseInt(e.css("padding-left"),10)||0,d=parseInt(e.css("padding-right"),10)||0,c=parseInt(e.css("border-left-width"),10)||0,p=parseInt(e.css("border-right-width"),10)||0;this.$relatedElement.addClass("form-control").css({display:i,"font-size":t.css("font-size"),"font-family":t.css("font-family"),"font-weight":t.css("font-weight"),"line-height":t.css("line-height"),color:t.css("color"),"z-index":"auto"===n?1001:n+1,margin:t.css("margin"),width:/inline/.test(i)?s+(a-o)+(d-h)+(c-r)+(p-l):s,height:"auto"})}}),n});
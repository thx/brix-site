define(["jquery","underscore","brix/base","css!./editable.css"],function(t,e,s){function i(){}return e.extend(i.prototype,s.prototype,{options:{type:"text",content:""},render:function(){var e=this,s=this.$element=t(this.element),i=this.$related=t(s.is("pre")?"<textarea>":'<input type="text">'),n=this.options.type,o=s[n]();o||s[n](o=this.options.content),i.addClass("form-control").val(o).insertAfter(s).hide(),s.on("click",function(){var t=s.css("display"),e=s.outerWidth(!0),n=s.css("z-index");s.hide(),i.css({display:t,"font-size":s.css("font-size"),"font-family":s.css("font-family"),"font-weight":s.css("font-weight"),"line-height":s.css("line-height"),color:s.css("color"),"z-index":"auto"===n?1001:n+1}).focus();var o=parseInt(s.css("padding-left"),10),r=parseInt(s.css("padding-right"),10),h=parseInt(s.css("border-left-width"),10),c=parseInt(s.css("border-right-width"),10),a=parseInt(i.css("padding-left"),10),d=parseInt(i.css("padding-right"),10),p=parseInt(i.css("border-left-width"),10),l=parseInt(i.css("border-right-width"),10);i.css({margin:s.css("margin"),width:/inline/.test(t)?e+(a-o)+(d-r)+(p-h)+(l-c):e,height:"auto"})}),i.on("keydown",function(t){13===t.which&&(t.preventDefault(),i.hide(),s.show(),e.update()),27===t.which&&(t.preventDefault(),i.val(s[n]()).hide(),s.show())}).on("blur",function(){i.hide(),s.show(),e.update()}),this.on("change",function(t,e){console.log(t.type,e)})},update:function(){var t=this.$element[this.options.type]()||this.options.content,e=this.$related.val(),s=this.options.type;t!==e&&this.trigger("change",e),this.$element[s](e)}}),i});
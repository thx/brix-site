define(["jquery","underscore","handlebars","components/base","./errortips.tpl.js"],function(t,i,e,s,n){function o(){arguments.length&&(this.element=t(arguments[0]),this.options=i.extend(this.options,arguments[1]))}var r={EVENTS:{".errortips-icon":{click:function(t,i){i._tips.fadeOut(.25,function(){i._tips.remove(),i.trigger("complete.errortips")},"easeOut")}}}};return i.extend(o.prototype,s.prototype,{options:{width:180,msg:"操作<span>不正确</span>，请重新操作",duration:null,shake:!0},render:function(){},destroy:function(){this._tips&&this._tips.remove()},showTips:function(i){var e=t(this.element);e.hasClass("btn-error")||(t(".btn-error-tips[data-btn-error]").length&&(clearTimeout(this.itv),t(".btn-error-tips[data-btn-error]").remove()),this.options.shake&&this._shake(),this._showTips(i),this._bindUI())},_bindUI:function(){var i=this._tips,e=this;t.each(r,function(s,n){switch(s){case"EVENTS":t.each(n,function(s,n){t.each(n,function(t,n){i.delegate(s,t,function(t){n(t,e)})})});break;case"DOCEVENTS":t.each(n,function(i,s){t.each(s,function(s,n){t(document).delegate(i,s,function(t){n(t,e)})})});break;case"WINEVENTS":t.each(n,function(i,s){t(window).on(i,function(t){s(t,e)})})}})},_showTips:function(i){var s=this,o=t(this.element),r=this.options.width,a=this.options.duration,h=30;i=i||this.options.msg,s.fadeOut&&s.fadeOut.stop(),a&&(this.itv=setTimeout(function(){s.fadeOut=s._tips.fadeOut(250,"swing",function(){s._tips.remove(),s.trigger("complete.errortips",s)})},a));var p=o.offset(),c=n,u=o.outerWidth()/2-10,d=e.compile(c)({width:r,msg:i,left:u+h,duration:a});this._tips=t(d),t("body").append(this._tips);var f=p.left-h,l=p.top-this._tips.outerHeight()-20,m=t(window).width(),_=f+this._tips.outerWidth()-m;_>0&&(f-=_,this._tips.find(".arrow").css({left:u+h+_})),0>f&&(this._tips.find(".arrow").css({left:u+h+f}),f=0),this._tips.css({left:f,top:l+25,opacity:0}),this._tips.animate({left:f,top:l,opacity:1},250,"swing")},_shake:function(){var i=t(this.element),e=i.width(),s=i.html();i.addClass("btn-error"),i.width(e),i.html('<i class="errortips-icon">&#xe600;</i>'),setTimeout(function(){i.html(s),i.removeClass("btn-error")},1e3)}}),o});
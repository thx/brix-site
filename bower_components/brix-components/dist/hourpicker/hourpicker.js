define(["jquery","underscore","moment","brix/base","brix/event","../dialog/position.js","./hourpicker.tpl.js","css!./hourpicker.css"],function(e,t,i,n,a,s,r){function o(){}var c=~location.search.indexOf("debug");return t.extend(o.prototype,n.prototype,{options:{utcOffset:function(){var e=i().utcOffset()/60,t=Math.abs(e),n=10>t?"0"+t:t;return n=0>e?"-"+n:"+"+n,n+=":00"}()},init:function(){},render:function(){var i=this;this.$element=e(this.element),this.manager=new a("bx-");var n=t.template(r)(this.options);this.$element.append(n),this.manager.delegate(this.$element,this),e(".picker-hours").contents().filter(function(e,t){return 3===t.nodeType}).remove();var s=e(".picker-hour");s.on("mousedown",function(t){var n=e(this),a=!n.hasClass("active");n.toggleClass("active"),i._merge(),i._syncShortcut();var s=e(this).siblings();s.on("mouseenter.drag",function(t){var n=e(this);n[a?"addClass":"removeClass"]("active"),i._merge(),i._syncShortcut(),t.preventDefault()}),e(document.body).off("mouseup.drag").on("mouseup.drag",function(){s.off("mouseenter.drag"),e(document.body).off("mouseup.drag"),c&&console.table(i.val())}),t.preventDefault()})},val:function(){return arguments.length?this._set.apply(this,arguments):this._get()},shortcut:function(e,i){void 0===i&&(i=e,e=void 0),i+="";var n=t.range(0,24),a={};t.each(i,function(e){a[e]=n}),this.val(a)},toggle:function(e,i){void 0===i&&(i=e,e=void 0);var n=t.range(0,24),a=this.val()[i];24===a.length?this.val(i,[]):this.val(i,n),e&&e.preventDefault()},apply:function(i,n,a){var r=this,o=e(i.target),c=e(".apply-dialog",this.$element);switch(n){case"to":this._tmp=this._tmp||{},this._tmp.from=a,this._tmp.$target=o.css("visibility","visible");var h=s(o,c,"bottom","right"),u=parseInt(c.css("margin-top"),10)||0;c.show().offset({left:h.left,top:h.top+u}),c.find("label[data-value]").removeClass("disabled").find('input[name="shortcut"]').prop({checked:!1,disabled:!1}).end().end().find("label[data-value="+a+"]").addClass("disabled").find("input").prop("disabled",!0);break;case"do":var l=t.map(c.find("input:checked"),function(e){return e.value}),d=this.val()[this._tmp.from];t.each(l,function(e){r.val(e,d)}),c.hide(),this._tmp.$target.css("visibility","inherit");break;case"close":this._tmp.$target.css("visibility","inherit"),c.hide()}},_get:function(){var i,n,a={},s=this.$element.find(".picker-day");return t.each(s,function(s){s=e(s),n=[],i=s.find(".picker-hour.active"),t.each(i,function(t){n.push(e(t).attr("data-value"))}),a[s.attr("data-value")]=n}),a},_set:function(e){var i=[].slice.call(arguments),n=this.$element.find(".picker-day");2===arguments.length?(e={},e[i[0]]=i[1],n.filter("[data-value="+i[0]+"]").find(".picker-hour").removeClass("active")):n.find(".picker-hour").removeClass("active");var a;t.each(e,function(e,i){a=n.filter("[data-value="+i+"]").find(".picker-hour"),t.each(e,function(e){a.filter("[data-value="+e+"]").addClass("active")})}),this._merge(),this._syncShortcut()},_merge:function(){var i=e(".picker-hour");t.each(i,function(t){t=e(t);var i=t.find(".picker-hour-start"),n=t.find(".picker-hour-end");t.hasClass("active")?(i[t.prev().hasClass("active")?"hide":"show"](),n[t.next().hasClass("active")?"hide":"show"]()):(i.hide(),n.hide())})},_syncShortcut:function(){function t(e,t){for(var n,a=0;a<e.length;a++)if(n=e[a],i[n].length<24)return!1;for(var s=0;s<t.length;s++)if(n=t[s],0!==i[n].length)return!1;return!0}var i=this.val();e(".shortcuts input[name=shortcut]:eq(0)",this.$element).prop("checked",t("0123456","")),e(".shortcuts input[name=shortcut]:eq(1)",this.$element).prop("checked",t("12345","06")),e(".shortcuts input[name=shortcut]:eq(2)",this.$element).prop("checked",t("06","12345"))}}),o});
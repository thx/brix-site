define(["jquery","underscore","brix/loader","components/base","brix/event","./state.js","./pagination.tpl.js","css!./pagination.css"],function(t,s,i,e,n,o,a){function r(){}return s.extend(r.prototype,e.prototype,{options:{statistics:!0,simplify:!1,step:7,total:0,cursor:1,limit:10,limits:[10,20,30,40,50]},init:function(){this._state=new o(this.options.total,this.options.cursor,this.options.limit)},render:function(){var e=this,o=new n;this.$element=t(this.element),this.data=this.fixData();var r=s.template(a)(this.data);t(this.element).empty().append(r),o.delegate(this.element,this),i.boot(this.element,function(){e.dropdown=i.query("components/dropdown",e.element)[0],e.dropdown&&e.dropdown.on("change.dropdown",function(t,s){e._state.setLimit(s.value),e.trigger("change.pagination",e._state),e.render()})})},moveTo:function(t,s){1===arguments.length&&(s=t),this._state.moveTo(s),this.trigger("change.pagination",this._state),this.render()},total:function(t){return void 0===t||null===t?this._state.total:(this._state.total!==t&&(this._state.setTotal(t),this.render()),this)},cursor:function(t){return void 0===t||null===t?this._state.cursor:(this._state.cursor!==t&&(this._state.setCursor(t),this.render()),this)},fixData:function(){var t=Math.min(this._state.pages,Math.max(1,this._state.cursor-parseInt(this.options.step/2,10))),i=+this.options.limit,e=[].concat(this.options.limits).sort();if(!s.contains(e,i))switch(!0){case i<e[0]:e.unshift(i);break;case i>e[e.length-1]:e.push(i);break;default:for(var n=0;n<e.length;n++)if(i>e[n]){e.splice(n+1,0,i);break}}return s.extend({barStart:t,barEnd:Math.min(this._state.pages,t+this.options.step-1),limits:e,simplify:this.options.simplify},this._state)}}),r});
define(["jquery","underscore","brix/base","../dialog/position.js","./popover.tpl.js"],function(t,e,i,o,n){function s(){}function r(e,i,o,n){var s,r,a=t(e),f=a.offset(),m=f.left,p=f.top,d=a.outerWidth(),u=a.outerHeight(),c=t(i).show(),$=c.outerWidth(),v=c.outerHeight(),E=t(i).find(".arrow"),g=E.outerWidth(),w=E.outerHeight();if(l.test(o)!==l.test(n)&&h.test(o)!==h.test(n))switch(n){case"top":case"bottom":v>u&&(r=p+u/2-w/2);break;case"left":case"right":$>d&&(s=m+d/2-g/2)}return{left:s,top:r}}e.extend(s.prototype,i.prototype,{options:{placement:"right",align:"",offset:{},width:"auto",title:"",content:"",delay:100},init:function(){},render:function(){var i=this;this.$element=t(this.element),this.$relatedElement=t(e.template(n)(this.options)).insertAfter(this.$element),this.$element.hover(function(){i.show()},function(){i.hide()}),i.$relatedElement.hover(function(){clearTimeout(i._timer)},function(){clearTimeout(i._timer),i.$relatedElement.hide()})},show:function(){clearTimeout(this._timer),this.$relatedElement.show().css({width:this.options.width,"max-width":this.options.width});var t=o(this.$element,this.$relatedElement,this.options.placement,this.options.align),e=parseInt(this.$relatedElement.css("margin-left"),10)||0,i=parseInt(this.$relatedElement.css("margin-top"),10)||0;if(this.$relatedElement.offset({left:t.left+e+(this.options.offset.left||0),top:t.top+i+(this.options.offset.top||0)}),this.options.align){var n=this.$relatedElement.find(".arrow");n.is(":visible")&&n.offset(r(this.$element,this.$relatedElement,this.options.placement,this.options.align))}},hide:function(){var t=this;clearTimeout(this._timer),this._timer=setTimeout(function(){t.$relatedElement.hide()},this.options.delay)},title:function(t){return void 0===t||null===t?this.options.title:(this.options.title=t,this.$relatedElement.find(".popover-title").html(t),this)},content:function(t){return void 0===t||null===t?this.options.content:(this.options.content=t,this.$relatedElement.find(".popover-content").html(t),this)},destroy:function(){this.$element.off("mouseenter mouseleave"),this.$relatedElement.off("mouseenter mouseleave").remove()}});var l=/top|bottom/,h=/left|right/;return s});
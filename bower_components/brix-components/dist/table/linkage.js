define(["jquery","underscore"],function(e,n){function t(n,i){var d="["+u+"],["+o+"]";e(n).on("click",d,function(u){a(e(u.currentTarget),e(u.delegateTarget)),r(e(u.currentTarget),e(u.delegateTarget)),c(e(u.currentTarget),e(u.delegateTarget)),i&&i(u,t.val(n),u.currentTarget)})}function a(e,t){var r=e.attr(o),c=t.find(n.template(d)({name:r}));if(c.length){var i=t.find(n.template(f)({name:r}));i.length&&(c.prop("checked",i.length===i.filter(":checked").length),a(c,t))}}function r(t,a){var c=t.attr(u),i=t.prop("checked"),o=a.find(n.template(f)({name:c}));o.length&&(o.prop("checked",i),n.each(o,function(n){r(e(n),a)}))}function c(t,c){if(t.is(":radio")){var i=t.attr("name"),u=e('[name="'+i+'"]',c).not(t);n.each(u,function(n){a(e(n),c),r(e(n),c)})}}var i="data-linkage-",u=i+"name",o=i+"parent-name",d="["+u+'="<%= name %>"]',f="["+o+'="<%= name %>"]';return t.val=function(c,i){if(i){var u=e(c).find("input:checkbox, input:radio").prop("checked",!1);return n.each(i,function(t){var i=u.filter('[value="'+t+'"]').prop("checked",!0);n.each(i,function(n){a(e(n),e(c)),r(e(n),e(c))})}),t}i=[];var o=e(c).find("input:checkbox:checked, input:radio:checked");return n.each(o,function(n){var t=e(n).attr("value");void 0!==t&&""!==t&&i.push(t)}),i},t});
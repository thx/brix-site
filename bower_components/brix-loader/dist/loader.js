define("brix/loader/constant",[],function(){var e="0.0.x",t=(Math.random()+"").replace(/\D/g,"");return{VERSION:e,ROOT_CLIENT_ID:-1,ATTRS:{id:"bx-name",options:"bx-options"},SELECTORS:{id:"[bx-name]",options:"[bx-options]"},EVENTS:{ready:"ready",destroy:"destroy"},OPTIONS:["element","relatedElement","moduleId","clientId","parentClientId","childClientIds"],EXPANDO:"Brix"+e+t,UUID:0,RE_EVENT:/bx\-(?!name|options)(.+)/,FN_ARGS:/([^()]+)(?:\((.*?)\))?/,LOADER_NAMESPACE:"._loader",COMPONENT_NAMESPACE:"._component",PREFIX:"bx-"}}),define("brix/loader/util",[],function(){function e(){this.list=[]}function t(){var e=this;this.state="pending",this.resolvedList=[],this.resolvedListIndex=0,this.rejectedList=[],this.rejectedListIndex=0,this.progressedList=[],this.progressedListIndex=0,this.promise={then:function(){return e.then.apply(e,arguments),this},"finally":function(){return e["finally"].apply(e,arguments),this}}}var n={},i=Array.prototype.slice,r=Array.prototype.concat,o=Object.prototype.toString,u=Object.prototype.hasOwnProperty;n.each=function(e,t,n){if(null===e||void 0===e)return e;if(e.forEach)e.forEach(t,n);else if(e.length===+e.length)for(var i=0,r=e.length;r>i;i++)t.call(n,e[i],i,e);else for(var o in e)t.call(n,e[o],o,e);return e},n.map=function(e,t,i){var r=[];return null===e||void 0===e?r:e.map===Array.prototype.map?e.map(t,i):(n.each(e,function(e,n,o){r.push(t.call(i,e,n,o))}),r)},n.without=function(e){var t=[],r=i.call(arguments,1);return n.each(e,function(e){var i=!1;n.each(r,function(t){i||t!==e||(i=!0)}),i||t.push(e)}),t},n.unique=function(e){var t=[];return n.each(e.sort(),function(n,i){(0===i||n!==e[i-1])&&t.push(n)}),t},n.pick=function(e){var t={},o=r.apply([],i.call(arguments,1));return n.each(o,function(n){n in e&&(t[n]=e[n])}),t},n.extend=function(e){return n.each(i.call(arguments,1),function(t){if(t)for(var n in t)e[n]=t[n]}),e},n.keys=function(e){if(!n.isObject(e))return[];if(Object.keys)return Object.keys(e);var t=[];for(var i in e)n.has(e,i)&&t.push(i);return t},n.values=function(e){for(var t=t(e),n=t.length,i=new Array(n),r=0;n>r;r++)i[r]=e[t[r]];return i},n.isElement=function(e){return!(!e||1!==e.nodeType)},n.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e){n["is"+e]=function(t){return o.call(t)=="[object "+e+"]"}}),n.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},n.isNaN=function(e){return n.isNumber(e)&&e!=+e},n.isBoolean=function(e){return e===!0||e===!1||"[object Boolean]"==o.call(e)},n.isNull=function(e){return null===e},n.isUndefined=function(e){return void 0===e},n.has=function(e,t){return u.call(e,t)},n.parse=function(e){e=e||location.hash;var t=/#?!?([^?]*)\??(.*)?/,n=t.exec(e);return{path:n[1],params:this.unparam(n[2])}},n.param=function(e){if(!e)return"";var t=/%20/g,i=[];return n.each(e,function(e,t){""!==e&&i.push(encodeURIComponent(t)+"="+encodeURIComponent(e))}),i.join("&").replace(t,"+")},n.unparam=function(e){if(!e)return{};for(var t,n={},i=0,r=e.split("&");t=r[i];i++)t=t.split("="),n[t[0]]=t[1];return n},n.trimHTML=function(e){var t=e.outerHTML.split("\n"),i=t[t.length-1].match(/^([\s\t]*)/)[0].length;return n.map(t,function(e,t){return 0===t?e:e.slice(i)}).join("\n")},n.trimPredefined=function(e){var t,i=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,r=e.innerHTML.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&"),o=r.split("\n");return n.each(o,function(e){e&&void 0===t&&(t=e.match(/^([\s\t]*)/)[0].length)}),o=n.map(o,function(e){return e.slice(t)}),o.join("\n").replace(i,"")},e.prototype={queue:function(e){return this.list.push(e),this},dequeue:function(){function e(){t.dequeue()}var t=this,n=this.list.shift();return n&&n(e),this},delay:function(e){return this.queue(function(t){setTimeout(t,e)})},clear:function(){return this.list=[],this}},n.queue=function(){return new e},t.prototype={then:function(e,t,n){return e&&(e["finally"]?this.resolvedList.push(e):this.resolvedList.splice(this.resolvedListIndex++,0,e)),t&&(t["finally"]?this.rejectedList.push(t):this.rejectedList.splice(this.rejectedListIndex++,0,t)),n&&this.progressedList.push(n),"resolved"===this.state&&e&&e(this.args),"rejected"===this.state&&t&&t(this.args),this},resolve:function(e){if(this.args=e,"pending"!==this.state)return this;this.state="resolved";for(var t=0;t<this.resolvedList.length;t++)this.resolvedList[t](e);return this},reject:function(e){if(this.args=e,"pending"!==this.state)return this;this.state="rejected";for(var t=0;t<this.rejectedList.length;t++)this.rejectedList[t](e);return this},notify:function(e){for(var t=0;t<this.progressedList.length;t++)this.progressedList[t](e);return this},"finally":function(e){return e["finally"]=!0,this.then(e,e)}},n.defer=function(){return new t},n.when=function(){};var c={push:function(e,t){this.timers=this.timers||{},this.timers[t]=this.timers[t]||[],this.timers[t].push(e),this.run()},pop:function(e,t){var n=this.timers;if(n&&n[t])for(var i=0;i<n[t].length;i++)n[t]===e&&n[t].splice(i--,1)},run:function(){n.each(this.timers,function(e,t){return e.length?void(e.timer||(e.timer=setInterval(function(){n.each(e,function(e){e()})},t))):void clearInterval(e.timer)})}};return n.Timer=c,n}),define("brix/loader/options",["./constant","./util"],function(Constant,Util){function parse(e){var t,n,i,r,o;if(i=e.getAttribute(Constant.ATTRS.id),!i)return{};r=Constant.UUID++,void 0===e.clientId&&(e.clientId=r),n=e;do n=n.parentNode;while(n&&9!==n.nodeType&&11!==n.nodeType&&void 0===n.clientId);o=n&&1===n.nodeType?+n.clientId:Constant.ROOT_CLIENT_ID,t=e.getAttribute(Constant.ATTRS.options);try{t=t?new Function("return "+t)():{}}catch(u){t={}}return t.element=e,t.moduleId=i,t.clientId=r,t.parentClientId=o,t.childClientIds=[],Util.extend(t,data(e)),t}function data(element){var options={};return Util.each(element.attributes,function(attribute){var ma=/data-(.+)/.exec(attribute.name);if(ma){var value=attribute.value;try{options[ma[1]]=/^\s*[\[{]/.test(value)?eval("(function(){ return Array.prototype.slice.call(arguments)[0] })("+value+")"):value}catch(error){options[ma[1]]=value}"true"===options[ma[1]]&&(options[ma[1]]=!0),"false"===options[ma[1]]&&(options[ma[1]]=!1)}}),options}return{parse:parse}}),define("brix/loader",["./loader/constant","./loader/options","./loader/util"],function(e,t,n){function i(t,i,o,u){t=t.element||t;var c=n.queue(),s=[],l=function(){var i=t.nodeType?[t]:t,r=[];return n.each(i,function(t){if(t=t.element||t,1===t.nodeType){t.getAttribute(e.ATTRS.id)&&r.push(t);var i=t.getElementsByTagName("*");n.each(i,function(t){/pre|code/i.test(t.parentNode.nodeName)||1===t.nodeType&&t.getAttribute(e.ATTRS.id)&&r.push(t)})}}),r}();n.each(l,function(e,t){c.queue(function(n){r(e,function(e,i){s.push([e,i,t,l.length]),e&&console.error(e.stack),u&&u(e,i,t,l.length),n()},o)})}),c.queue(function(){i&&i(s)}).dequeue()}function r(r,c,s){var l=n.queue(),a=r.clientId;if(void 0!==a)return void(c&&c(void 0,f[a]));if(!r.getAttribute(e.ATTRS.id))return void(c&&c(void 0,void 0));var d=t.parse(r);s&&n.extend(d,s);var p,v,m="module "+d.moduleId+" "+d.clientId;if(h){console.group(m),console.time(m);var g=c;c=function(e,t){console.timeEnd(m),console.groupEnd(m),g&&g(e,t)}}l.queue(function(e){require([d.moduleId],function(t){p=t,e()},function(e){c?c(e,v):console.error(e)})}).queue(function(t){try{v=p.length?new p(d):new p,v.options=n.extend({},v.options,d),n.extend(v,n.pick(d,e.OPTIONS)),t()}catch(i){c?c(i,v):console.error(i)}}).queue(function(e){v._destroy=v.destroy,v.destroy=function(){o(!1,v)},e()}).queue(function(e){u(v),e()}).queue(function(e){if(!v.init)return void e();try{var t=v.init();h&&console.log(m,"call  init"),t&&t.then?t.then(function(){e()},function(e){throw e}):e()}catch(n){c?c(n,v):console.error(n)}}).queue(function(e){return v._render?void e():(v._render=v.render,v.render=function(){function e(){r?i(v.element,function(){u.resolve()}):u.resolve()}function t(){var e=v.relatedElement||v.$relatedElement;e&&(e.nodeType&&void 0===e.clientId?e.clientId=d.clientId:e.length&&n.each(e,function(e){e.nodeType&&void 0===e.clientId&&(e.clientId=d.clientId)}))}var r,u=n.defer(),c=u.promise;v.childClientIds.length&&(r=!0,n.each(v.childClientIds,function(e){f[e]&&o(e)}));var s;return v._render?s=v._render.apply(v,arguments):console.warn(v.clientId,v.moduleId,"找不到方法 render() "),s&&s.then?s.then(function(){e(),t()},function(e){throw e}):(e(),t()),c},void e())}).queue(function(e){try{var t=v.render(function(e){});h&&console.log(m,"call  render"),t&&t.then?t.then(function(){e()},function(e){c?c(e,v):console.error(e)}):e()}catch(n){c?c(n,v):console.error(n)}}).queue(function(t){h&&v.on&&n.each(e.EVENTS,function(t){v.on(t+e.LOADER_NAMESPACE,function(e){console.log(m,"event",e.type)})}),t()}).queue(function(e){e()}).queue(function(t){var o=r.getElementsByTagName("*"),u=!1;n.each(o,function(t){1===t.nodeType&&!u&&t.getAttribute(e.ATTRS.id)&&(u=!0)}),u?i(v,function(){t()}):t()}).queue(function(){v.triggerHandler&&v.triggerHandler(e.EVENTS.ready),c&&c(void 0,v)}).dequeue()}function o(t,i,r,u){var s;if(n.isBoolean(t)||(u=r,r=i,i=t,t=!0),n.isFunction(r)&&(u=r,r=void 0),void 0===i)return u&&u(),this;if(n.isString(i)&&(s=c(i,r),!s))return u&&u(),this;if(void 0===i.clientId&&!n.isNumber(i)&&!i.nodeType&&!i.length)return u&&u(),this;if(i.clientId&&(s=i),n.isNumber(i)&&(s=f[i],!s))return u&&u(),this;if(!n.isString(i)&&!n.isNumber(i)&&!i.nodeType&&i.length)return n.each(i,function(e){o(t,e,r)}),u&&u(),this;if(1===i.nodeType){if(void 0===i.clientId){for(var l,a=i.getElementsByTagName("*"),d=a.length-1;d>=0;d--)l=a[d],l&&1===l.nodeType&&l.getAttribute(e.ATTRS.id)&&o(t,l);return u&&u(),this}s=f[i.clientId]}if(!s)return u&&u(),this;if(n.isArray(s)&&s.length)return n.each(s,function(e){o(t,e,r)}),u&&u(),this;var p="module "+s.moduleId+" "+s.clientId;if(h){console.group(p),console.time(p);var v=u;u=function(e,t){console.timeEnd(p),console.groupEnd(p),v&&v(e,t)}}if(s.childClientIds.length&&n.each(s.childClientIds,function(e){o(t,e)}),s._destroy)try{s._destroy()}catch(m){u?u(m):console.error(m)}delete f[s.clientId];var g=f[s.parentClientId];return g&&(g.childClientIds=n.without(g.childClientIds,s.clientId)),s.triggerHandler&&s.triggerHandler(e.EVENTS.destroy),s.off&&n.each(s.options.events,function(t){s.off(t.type+e.LOADER_NAMESPACE)}),s.element&&(s.element.clientId=void 0,t&&s.element.parentNode&&s.element.parentNode.removeChild(s.element)),h&&console.log(p,"destroy"),u&&u(),this}function u(e){f[e.clientId]=e;var t=f[e.parentClientId];t&&t.childClientIds.push(e.clientId)}function c(e,t){var i=[],r=[];return e.nodeType?void 0!==e.clientId&&f[e.clientId]&&i.push(f[e.clientId]):e.length&&!n.isString(e)?n.each(e,function(e){void 0!==e.clientId&&f[e.clientId]&&i.push(f[e.clientId])}):n.each(f,function(n){n.moduleId===e&&(void 0===t||s(n,t).length)&&i.push(n)}),n.each(i,function(e){e&&n.each(e.constructor.prototype,function(e,t){n.isFunction(e)&&"_"!==t[0]&&r.push(t)})}),n.each(n.unique(r),function(e){i[e]=function(){var t,i=[].slice.call(arguments),r=!1,o=[];return n.each(this,function(n){n[e]&&(t=n[e].apply(n,i),void 0!==t&&t!==n&&(r=!0,o.push(t)))}),r?o:this}}),i}function s(e,t){var i,r=[];if(void 0===t)return r;if(!n.isString(t)&&!t.nodeType&&t.length)return n.each(t,function(t){r=r.concat(s(e,t))}),r;if(t.options&&t.render){for(i=e;i=f[i.parentClientId];)if(i.clientId===t.clientId){r.push(i);break}}else if(t.nodeType){for(i=e.element;i=i.parentNode;)if(i===t){r.push(i);break}}else for(i=e;i=f[i.parentClientId];)i.moduleId===t&&r.push(i);return r}function l(e,t,r,u){return e.nodeType&&(e=[e]),n.isFunction(r)&&(u=r,r=void 0),o(e),n.each(e,function(e){e.innerHTML='<div bx-name="'+t+'"></div>'}),i(e,u,r),this}function a(e,t){return o(e,t),this}function d(){function t(e,i){return n.each(f,function(n){n.parentClientId===e&&i.push({name:n.moduleId+","+n.clientId,module:n,children:t(n.clientId,[])})}),i}var i={name:"root",children:[]};return t(e.ROOT_CLIENT_ID,i.children),i}var f={},h=~location.search.indexOf("brix.loader.debug"),p=n.queue(),v={CACHE:f,tasks:p,booting:!1,boot:function(e,t,r,o){n.isBoolean(e)||(o=r,r=t,t=e,e=!1),n.isFunction(t)?(o=r,r=t,t=document.body):t=t?t.element||t:document.body,h&&console.log("call boot",t);var u=arguments.callee.caller;return p.queue(function(e){var n="queue boot";h&&(console.group(n),console.time(n),console.log("context:",t),console.log("takks.list:",p.list.length)),v.booting=u,i(t,function(t){if(r)try{r(t)}catch(i){console.error(i)}v.booting=!1,h&&(console.log(t.length,t),console.timeEnd(n),console.groupEnd(n)),e()},null,o)}),(!v.booting||e)&&p.dequeue(),this},destroy:o,query:c,tree:d,load:function(e,t,i,r,o){n.isBoolean(e)||(o=r,r=i,i=t,t=e,e=!1),n.isFunction(r)&&(o=r,r=void 0);var u=arguments.callee.caller;return p.queue(function(e){v.booting=u,l(t,i,r,function(t){if(v.booting=!1,o)try{o(t)}catch(n){console.error(n)}e()})}),(!v.booting||e)&&p.dequeue(),this},unload:a,Util:n,Constant:e,Options:t};return v});
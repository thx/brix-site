define("brix/loader/constant",[],function(){var e="0.0.x",t=(Math.random()+"").replace(/\D/g,"");return{VERSION:e,ROOT_CLIENT_ID:-1,ATTRS:{id:"bx-name",options:"bx-options"},SELECTORS:{id:"[bx-name]",options:"[bx-options]"},EVENTS:{ready:"ready",destroy:"destroy"},OPTIONS:["element","relatedElement","moduleId","clientId","parentClientId","childClientIds"],EXPANDO:"Brix"+e+t,UUID:0,RE_EVENT:/bx\-(?!name|options)(.+)/,FN_ARGS:/([^()]+)(?:\((.*?)\))?/,LOADER_NAMESPACE:"._loader",COMPONENT_NAMESPACE:"._component",PREFIX:"bx-"}}),define("brix/loader/util",[],function(){function e(){this.list=[]}function t(){var e=this;this.state="pending",this.resolvedList=[],this.resolvedListIndex=0,this.rejectedList=[],this.rejectedListIndex=0,this.progressedList=[],this.progressedListIndex=0,this.promise={then:function(){return e.then.apply(e,arguments),this},"finally":function(){return e["finally"].apply(e,arguments),this}}}var n={},r=Array.prototype.slice,i=Array.prototype.concat,o=Object.prototype.toString,u=Object.prototype.hasOwnProperty;n.each=function(e,t,n){if(null===e||void 0===e)return e;if(e.forEach)e.forEach(t,n);else if(e.length===+e.length)for(var r=0,i=e.length;i>r;r++)t.call(n,e[r],r,e);else for(var o in e)t.call(n,e[o],o,e);return e},n.map=function(e,t,r){var i=[];return null===e||void 0===e?i:e.map===Array.prototype.map?e.map(t,r):(n.each(e,function(e,n,o){i.push(t.call(r,e,n,o))}),i)},n.without=function(e){var t=[],i=r.call(arguments,1);return n.each(e,function(e){var r=!1;n.each(i,function(t){r||t!==e||(r=!0)}),r||t.push(e)}),t},n.unique=function(e){var t=[];return n.each(e.sort(),function(n,r){(0===r||n!==e[r-1])&&t.push(n)}),t},n.pick=function(e){var t={},o=i.apply([],r.call(arguments,1));return n.each(o,function(n){n in e&&(t[n]=e[n])}),t},n.extend=function(e){return n.each(r.call(arguments,1),function(t){if(t)for(var n in t)e[n]=t[n]}),e},n.extend=function(){var e,t,r,i,o,u=arguments[0],c=1,s=arguments.length,a=!1;for("boolean"==typeof u&&(a=u,u=arguments[c]||{},c++),"object"!=typeof u&&"function"!=typeof u&&(u={}),1===s&&(u=this,c=0);s>c;c++)if(e=arguments[c])for(t in e)r=u[t],i=e[t],u!==i&&void 0!==i&&(a&&(n.isArray(i)||n.isPlainObject(i))?(n.isArray(i)&&(o=r&&n.isArray(r)?r:[]),n.isPlainObject(i)&&(o=r&&n.isPlainObject(r)?r:{}),u[t]=n.extend(a,o,i)):u[t]=i);return u},n.keys=function(e){if(!n.isObject(e))return[];if(Object.keys)return Object.keys(e);var t=[];for(var r in e)n.has(e,r)&&t.push(r);return t},n.values=function(e){for(var t=t(e),n=t.length,r=new Array(n),i=0;n>i;i++)r[i]=e[t[i]];return r},n.isElement=function(e){return!(!e||1!==e.nodeType)},n.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e){n["is"+e]=function(t){return o.call(t)=="[object "+e+"]"}}),n.isPlainObject=function(e){if(!e||!n.isObject(e)||e.nodeType||n.isWindow(e))return!1;try{if(e.constructor&&!u.call(e,"constructor")&&!u.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(t){return!1}var r;for(r in e);return void 0===r||u.call(e,r)},n.isWindow=function(e){return e&&e===e.window},n.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},n.isNaN=function(e){return n.isNumber(e)&&e!=+e},n.isBoolean=function(e){return e===!0||e===!1||"[object Boolean]"==o.call(e)},n.isNull=function(e){return null===e},n.isUndefined=function(e){return void 0===e},n.has=function(e,t){return u.call(e,t)},n.parse=function(e){e=e||location.hash;var t=/#?!?([^?]*)\??(.*)?/,n=t.exec(e);return{path:n[1],params:this.unparam(n[2])}},n.param=function(e){if(!e)return"";var t=/%20/g,r=[];return n.each(e,function(e,t){""!==e&&r.push(encodeURIComponent(t)+"="+encodeURIComponent(e))}),r.join("&").replace(t,"+")},n.unparam=function(e){if(!e)return{};for(var t,n={},r=0,i=e.split("&");t=i[r];r++)t=t.split("="),n[t[0]]=t[1];return n},n.trimHTML=function(e){var t=e.outerHTML.split("\n"),r=t[t.length-1].match(/^([\s\t]*)/)[0].length;return n.map(t,function(e,t){return 0===t?e:e.slice(r)}).join("\n")},n.trimPredefined=function(e){var t,r=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,i=e.innerHTML.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&"),o=i.split("\n");return n.each(o,function(e){e&&void 0===t&&(t=e.match(/^([\s\t]*)/)[0].length)}),o=n.map(o,function(e){return e.slice(t)}),o.join("\n").replace(r,"")},e.prototype={queue:function(e){return this.list.push(e),this},dequeue:function(){function e(){t.dequeue()}var t=this,n=this.list.shift();return n&&n(e),this},delay:function(e){return this.queue(function(t){setTimeout(t,e)})},clear:function(){return this.list=[],this}},n.queue=function(){return new e},t.prototype={then:function(e,t,n){return e&&(e["finally"]?this.resolvedList.push(e):this.resolvedList.splice(this.resolvedListIndex++,0,e)),t&&(t["finally"]?this.rejectedList.push(t):this.rejectedList.splice(this.rejectedListIndex++,0,t)),n&&this.progressedList.push(n),"resolved"===this.state&&e&&e(this.args),"rejected"===this.state&&t&&t(this.args),this},resolve:function(e){if(this.args=e,"pending"!==this.state)return this;this.state="resolved";for(var t=0;t<this.resolvedList.length;t++)this.resolvedList[t](e);return this},reject:function(e){if(this.args=e,"pending"!==this.state)return this;this.state="rejected";for(var t=0;t<this.rejectedList.length;t++)this.rejectedList[t](e);return this},notify:function(e){for(var t=0;t<this.progressedList.length;t++)this.progressedList[t](e);return this},"finally":function(e){return e["finally"]=!0,this.then(e,e)}},n.defer=function(){return new t},n.when=function(){};var c={push:function(e,t){this.timers=this.timers||{},this.timers[t]=this.timers[t]||[],this.timers[t].push(e),this.run()},pop:function(e,t){var n=this.timers;if(n&&n[t])for(var r=0;r<n[t].length;r++)n[t]===e&&n[t].splice(r--,1)},run:function(){n.each(this.timers,function(e,t){return e.length?void(e.timer||(e.timer=setInterval(function(){n.each(e,function(e){e()})},t))):void clearInterval(e.timer)})}};return n.Timer=c,n}),define("brix/loader/options",["./constant","./util"],function(Constant,Util){function parse(e){var t,n,r,i,o;if(r=e.getAttribute(Constant.ATTRS.id),!r)return{};i=Constant.UUID++,void 0===e.clientId&&(e.clientId=i),n=e;do n=n.parentNode;while(n&&9!==n.nodeType&&11!==n.nodeType&&void 0===n.clientId);o=n&&1===n.nodeType?+n.clientId:Constant.ROOT_CLIENT_ID,t=e.getAttribute(Constant.ATTRS.options);try{t=t?new Function("return "+t)():{}}catch(u){t={}}return t.element=e,t.moduleId=r,t.clientId=i,t.parentClientId=o,t.childClientIds=[],Util.extend(t,data(e)),t}function data(element){var options={};return Util.each(element.attributes,function(attribute){var ma=/data-(.+)/.exec(attribute.name);if(ma){var value=attribute.value;try{options[ma[1]]=/^\s*[\[{]/.test(value)?eval("(function(){ return Array.prototype.slice.call(arguments)[0] })("+value+")"):value}catch(error){options[ma[1]]=value}"true"===options[ma[1]]&&(options[ma[1]]=!0),"false"===options[ma[1]]&&(options[ma[1]]=!1)}}),options}return{parse:parse}}),define("brix/loader",["./loader/constant","./loader/options","./loader/util"],function(e,t,n){function r(t,r,o,u){t=t.element||t;var c=n.queue(),s=[],a=function(){var r=t.nodeType?[t]:t,i=[];return n.each(r,function(t){if(t=t.element||t,1===t.nodeType){t.getAttribute(e.ATTRS.id)&&i.push(t);var r=t.getElementsByTagName("*");n.each(r,function(t){/pre|code/i.test(t.parentNode.nodeName)||1===t.nodeType&&t.getAttribute(e.ATTRS.id)&&i.push(t)})}}),i}();n.each(a,function(e,t){c.queue(function(n){i(e,function(e,r){s.push([e,r,t,a.length]),e&&console.error(e.stack||e),u&&u(e,r,t,a.length),e&&v.onerror&&v.onerror(e),n()},o)})}),c.queue(function(){r&&r(s)}).dequeue()}function i(i,c,s){var a=n.queue(),l=i.clientId;if(void 0!==l)return void(c&&c(void 0,f[l]));if(!i.getAttribute(e.ATTRS.id))return void(c&&c(void 0,void 0));var d=t.parse(i);s&&n.extend(d,s);var p,m,g="module "+d.moduleId+" "+d.clientId;if(h){console.group(g),console.time(g);var y=c;c=function(e,t){console.timeEnd(g),console.groupEnd(g),y&&y(e,t)}}a.queue(function(e){require([d.moduleId],function(t){p=t,e()},function(e){c?c(new Error(e.message),m):console.error(e.stack||e),v.onerror&&v.onerror(e)})}).queue(function(t){try{var r=p.__x_created_with;p.__x_created_with="Brix Loader",m=p.length?new p(d):new p,p.__x_created_with=r,m.options=n.extend(!0,{},m.options,d),n.extend(m,n.pick(d,e.OPTIONS)),t()}catch(i){c?c(i,m):console.error(i.stack||i),v.onerror&&v.onerror(i)}}).queue(function(e){m._destroy=m.destroy,m.destroy=function(){o(!1,m)},e()}).queue(function(e){u(m),e()}).queue(function(e){if(!m.init)return void e();try{h&&console.time(g+" call  init");var t=m.init();h&&console.timeEnd(g+" call  init"),t&&t.then?t.then(function(){e()},function(e){throw e}):e()}catch(n){c?c(n,m):console.error(n),v.onerror&&v.onerror(n)}}).queue(function(e){return m._render?void e():(m._render=m.render,m.render=function(){function e(){i?r(m.element,function(){u.resolve()}):u.resolve()}function t(){var e=m.relatedElement||m.$relatedElement;e&&(e.nodeType&&void 0===e.clientId?e.clientId=d.clientId:e.length&&n.each(e,function(e){e.nodeType&&void 0===e.clientId&&(e.clientId=d.clientId)}))}var i,u=n.defer(),c=u.promise;m.childClientIds.length&&(i=!0,n.each(m.childClientIds,function(e){f[e]&&o(e)}));var s;return m._render?s=m._render.apply(m,arguments):console.warn(m.clientId,m.moduleId,"render() is not defined"),s&&s.then?s.then(function(){e(),t()},function(e){throw e}):(e(),t()),c},void e())}).queue(function(e){try{h&&console.time(g+" call  render");var t=m.render(function(e){});h&&console.timeEnd(g+" call  render"),t&&t.then?t.then(function(){e()},function(e){c?c(e,m):console.error(e.stack||e),v.onerror&&v.onerror(e)}):e()}catch(n){c?c(n,m):console.error(n.stack||n),v.onerror&&v.onerror(n)}}).queue(function(t){h&&m.on&&n.each(e.EVENTS,function(t){m.on(t+e.LOADER_NAMESPACE,function(e){console.log(g,"event",e.type)})}),t()}).queue(function(t){var o=i.getElementsByTagName("*"),u=!1;n.each(o,function(t){1===t.nodeType&&!u&&t.getAttribute(e.ATTRS.id)&&(u=!0)}),u?r(m,function(){t()}):t()}).queue(function(){m.triggerHandler&&m.triggerHandler(e.EVENTS.ready),c&&c(void 0,m)}).dequeue()}function o(t,r,i,u){var s;if(n.isBoolean(t)||(u=i,i=r,r=t,t=!0),n.isFunction(i)&&(u=i,i=void 0),void 0===r)return u&&u(),this;if(n.isString(r)&&(s=c(r,i),!s))return u&&u(),this;if(void 0===r.clientId&&!n.isNumber(r)&&!r.nodeType&&!r.length)return u&&u(),this;if(r.clientId&&(s=r),n.isNumber(r)&&(s=f[r],!s))return u&&u(),this;if(!n.isString(r)&&!n.isNumber(r)&&!r.nodeType&&r.length)return n.each(r,function(e){o(t,e,i)}),u&&u(),this;if(1===r.nodeType){if(void 0===r.clientId){for(var a,l=r.getElementsByTagName("*"),d=l.length-1;d>=0;d--)a=l[d],a&&1===a.nodeType&&a.getAttribute(e.ATTRS.id)&&o(t,a);return u&&u(),this}s=f[r.clientId]}if(!s)return u&&u(),this;if(n.isArray(s)&&s.length)return n.each(s,function(e){o(t,e,i)}),u&&u(),this;var p="module "+s.moduleId+" "+s.clientId;if(h){console.group(p),console.time(p);var m=u;u=function(e,t){console.timeEnd(p),console.groupEnd(p),m&&m(e,t)}}if(s.childClientIds.length&&n.each(s.childClientIds,function(e){o(t,e)}),s._destroy)try{s._destroy()}catch(g){u?u(g):console.error(g.stack||g),v.onerror&&v.onerror(g)}delete f[s.clientId];var y=f[s.parentClientId];return y&&(y.childClientIds=n.without(y.childClientIds,s.clientId)),s.triggerHandler&&s.triggerHandler(e.EVENTS.destroy),s.element&&(s.element.clientId=void 0,t&&s.element.parentNode&&s.element.parentNode.removeChild(s.element)),h&&console.log(p,"destroy"),u&&u(),this}function u(e){f[e.clientId]=e;var t=f[e.parentClientId];t&&t.childClientIds.push(e.clientId)}function c(e,t){var r=[],i=[];return e.nodeType?void 0!==e.clientId&&f[e.clientId]&&r.push(f[e.clientId]):e.length&&!n.isString(e)?n.each(e,function(e){void 0!==e.clientId&&f[e.clientId]&&r.push(f[e.clientId])}):n.each(f,function(n){n.moduleId===e&&(void 0===t||s(n,t).length)&&r.push(n)}),n.each(r,function(e){e&&n.each(e.constructor.prototype,function(e,t){n.isFunction(e)&&"_"!==t[0]&&i.push(t)})}),n.each(n.unique(i),function(e){r[e]=function(){var t,r=[].slice.call(arguments),i=!1,o=[];return n.each(this,function(n){n[e]&&(t=n[e].apply(n,r),void 0!==t&&t!==n&&(i=!0,o.push(t)))}),i?o:this}}),r}function s(e,t){var r,i=[];if(void 0===t)return i;if(!n.isString(t)&&!t.nodeType&&t.length)return n.each(t,function(t){i=i.concat(s(e,t))}),i;if(t.options&&t.render){for(r=e;r=f[r.parentClientId];)if(r.clientId===t.clientId){i.push(r);break}}else if(t.nodeType){for(r=e.element;r=r.parentNode;)if(r===t){i.push(r);break}}else for(r=e;r=f[r.parentClientId];)r.moduleId===t&&i.push(r);return i}function a(e,t,i,u){return e.nodeType&&(e=[e]),n.isFunction(i)&&(u=i,i=void 0),o(e),n.each(e,function(e){e.innerHTML='<div bx-name="'+t+'"></div>'}),r(e,u,i),this}function l(e,t){return o(e,t),this}function d(){function t(e,r){return n.each(f,function(n){n.parentClientId===e&&r.push({name:n.moduleId+","+n.clientId,module:n,children:t(n.clientId,[])})}),r}var r={name:"root",children:[]};return t(e.ROOT_CLIENT_ID,r.children),r}var f={},h=~location.search.indexOf("brix.loader.debug"),p=n.queue(),v={CACHE:f,tasks:p,booting:!1,boot:function(e,t,i,o){n.isBoolean(e)||(o=i,i=t,t=e,e=!1),n.isFunction(t)?(o=i,i=t,t=document.body):t=t?t.element||t:document.body,h&&console.log("call boot",t);var u=arguments.callee.caller;return p.queue(function(e){var n="queue boot";h&&(console.group(n),console.time(n),console.log("context:",t),console.log("tasks.list:",p.list.length)),v.booting=u,r(t,function(t){if(i)try{i(t)}catch(r){console.error(r.stack||r),v.onerror&&v.onerror(r)}v.booting=!1,h&&(console.log(t.length,t),console.timeEnd(n),console.groupEnd(n)),e()},null,o)}),(!v.booting||e)&&p.dequeue(),this},destroy:function(){try{o.apply(this,arguments)}catch(e){console.error(e.stack||e),v.onerror&&v.onerror(e)}return this},query:c,tree:d,load:function(e,t,r,i,o){n.isBoolean(e)||(o=i,i=r,r=t,t=e,e=!1),n.isFunction(i)&&(o=i,i=void 0);var u=arguments.callee.caller;return p.queue(function(e){v.booting=u,a(t,r,i,function(t){if(v.booting=!1,o)try{o(t)}catch(n){console.error(n.stack||n)}e()})}),(!v.booting||e)&&p.dequeue(),this},unload:l,Util:n,Constant:e,Options:t};return v});